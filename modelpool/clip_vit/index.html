
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../nyuv2/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.9">
    
    
      
        <title>CLIP-ViT Models - FusionBench</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../css/mkdocstrings.css">
    
      <link rel="stylesheet" href="../../css/material_extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#clip-vit-models-for-open-vocabulary-image-classification" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="FusionBench" class="md-header__button md-logo" aria-label="FusionBench" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            FusionBench
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              CLIP-ViT Models
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5M7 15a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/tanganke/fusion_bench" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../.." class="md-tabs__link">
          
  
  Introduction

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../algorithms/" class="md-tabs__link">
          
  
  Algorithms

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  Model Pool (Benchmark Models)

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../taskpool/" class="md-tabs__link">
          
  
  Task Pool (Evaluation)

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../guides/fusion_bench/" class="md-tabs__link">
          
  
  Additional Guides

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../readinglist/" class="md-tabs__link">
          
  
  Reading Lists

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="FusionBench" class="md-nav__button md-logo" aria-label="FusionBench" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    FusionBench
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/tanganke/fusion_bench" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Introduction
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FusionBench
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction_to_model_fusion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deep Model Fusion (The Learn From Model Paradigm)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/fusion_bench/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    fusion_bench: The Command Line Interface for FusionBench
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/fusion_bench_webui/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FusionBench Command Generator WebUI
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Algorithms
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Algorithms
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algorithms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction to Algorithm Module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algorithms/dummy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dummy Algorithm
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Model Ensemble
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Model Ensemble
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algorithms/simple_ensemble/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Simple Ensemble
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algorithms/weighted_ensemble/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Weighted Ensemble
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algorithms/max-model_predictor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Max-Model Predictor
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Model Merging
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Model Merging
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algorithms/simple_averaging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Simple Averaging
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algorithms/weighted_averaging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Weighted Averaging
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algorithms/fisher_merging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fisher Merging
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algorithms/task_arithmetic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Task Arithmetic
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algorithms/ties_merging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ties-Merging
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algorithms/adamerging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AdaMerging
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algorithms/regmean/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RegMean
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algorithms/concrete_subspace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Concrete Subspace
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algorithms/isotropic_merging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Isotropic Merging
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Model Mixing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            Model Mixing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algorithms/depth_upscaling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Depth Upscaling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algorithms/moe_based_upscaling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MoE-based Upscaling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algorithms/moe_based_merging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MoE-based Merging
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algorithms/weight_ensembling_moe/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Weight-Ensembling MoE
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algorithms/pwe_moe/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PWE MoE
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algorithms/smile_upscaling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SMILE Upscaling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algorithms/model_recombination/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Model Recombination
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Model Pruning
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            Model Pruning
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algorithms/pruning/magnitude_pruning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Magnitude Pruning
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Model Pool (Benchmark Models)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Model Pool (Benchmark Models)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction to Model Pool Module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    CLIP-ViT Models
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    CLIP-ViT Models
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-eight-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      The Eight Tasks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The Eight Tasks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#performance-of-the-fine-tuned-models" class="md-nav__link">
    <span class="md-ellipsis">
      Performance of the Fine-tuned Models
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model-pool-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Model Pool Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lora-and-l-lora" class="md-nav__link">
    <span class="md-ellipsis">
      LoRA and L-LoRA
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Basic Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inspection-of-model-information" class="md-nav__link">
    <span class="md-ellipsis">
      Inspection of Model Information
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#single-model-evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      Single Model Evaluation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simple-averaging" class="md-nav__link">
    <span class="md-ellipsis">
      Simple Averaging
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fisher-merging" class="md-nav__link">
    <span class="md-ellipsis">
      Fisher Merging
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#regmean" class="md-nav__link">
    <span class="md-ellipsis">
      RegMean
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-arithmetic" class="md-nav__link">
    <span class="md-ellipsis">
      Task Arithmetic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ties-merging" class="md-nav__link">
    <span class="md-ellipsis">
      Ties-Merging
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adamerging" class="md-nav__link">
    <span class="md-ellipsis">
      AdaMerging
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weight-ensembling-moe" class="md-nav__link">
    <span class="md-ellipsis">
      Weight-Ensembling MoE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#experimental-results" class="md-nav__link">
    <span class="md-ellipsis">
      Experimental Results
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scope" class="md-nav__link">
    <span class="md-ellipsis">
      Scope
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Scope">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#task-vector-cosine-similarity" class="md-nav__link">
    <span class="md-ellipsis">
      Task Vector Cosine Similarity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generalization-and-robustness-evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      Generalization and Robustness Evaluation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#experimental-results_1" class="md-nav__link">
    <span class="md-ellipsis">
      Experimental Results
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
    <nav class="md-nav" aria-label="References">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fusion_bench.modelpool.clip_vision" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;clip_vision
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" clip_vision">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fusion_bench.modelpool.clip_vision.modelpool" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;modelpool
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" modelpool">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fusion_bench.modelpool.clip_vision.modelpool.CLIPVisionModelPool" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;CLIPVisionModelPool
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fusion_bench.models.linearized.vision_model" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;vision_model
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" vision_model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fusion_bench.models.linearized.vision_model.linearize_lora_model_" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;linearize_lora_model_
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fusion_bench.models.linearized.vision_model.load_fft_vision_model_hf" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;load_fft_vision_model_hf
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" load_fft_vision_model_hf">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fusion_bench.models.linearized.vision_model.load_fft_vision_model_hf(model_name)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;model_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fusion_bench.models.linearized.vision_model.load_fft_vision_model_hf(return_vison_model)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;return_vison_model
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fusion_bench.models.linearized.vision_model.load_l_lora_vision_model_hf" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;load_l_lora_vision_model_hf
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fusion_bench.models.linearized.vision_model.load_lora_vision_model_hf" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;load_lora_vision_model_hf
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" load_lora_vision_model_hf">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fusion_bench.models.linearized.vision_model.load_lora_vision_model_hf(base_model_name)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;base_model_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fusion_bench.models.linearized.vision_model.load_lora_vision_model_hf(peft_name)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;peft_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fusion_bench.models.linearized.vision_model.load_lora_vision_model_hf(merge_and_unload)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;merge_and_unload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fusion_bench.models.linearized.vision_model.load_lora_vision_model_hf(return_vison_model)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;return_vison_model
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nyuv2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ResNet Models for Sence Understanding
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gpt2_classification/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GPT-2 Models for Text Classification
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../flan-t5_generation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flan-T5 Models for Text Generation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Task Pool (Evaluation)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Task Pool (Evaluation)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../taskpool/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction to Taskpool Module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../taskpool/dummy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dummy TaskPool
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Task Pool for Llama Models
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Task Pool for Llama Models
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../taskpool/LlamaTestGenerationTaskPool/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LlamaTestGenerationTaskPool
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../taskpool/clip_vit_classification/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Classification Tasks for CLIP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../taskpool/gpt2_classification/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GPT-2 Sequence Classification Tasks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../taskpool/flan-t5_generation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flan-T5 Models for Text Generation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Additional Guides
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Additional Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    FusionBench Programming Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            FusionBench Programming Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/fusion_bench/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_1_2" >
        
          
          <label class="md-nav__link" for="__nav_5_1_2" id="__nav_5_1_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Mixins
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_2">
            <span class="md-nav__icon md-icon"></span>
            Mixins
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/fusion_bench/mixins/lightning_fabric/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LightningFabricMixin
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/fusion_bench/mixins/simple_profiler/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SimpleProfilerMixin
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    CLIP-ViT Models For Image Classification
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            CLIP-ViT Models For Image Classification
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/clip_vit/HFCLIPClassifier/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Image Classification with CLIP Models using HFCLIPClassifier
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/clip_vit/classification_templates/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Manage Labels and Templates
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/clip_vit/finetune/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fine-Tune Your Own Vision Transformer
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Natural Language Processing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Natural Language Processing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_3_1" >
        
          
          <label class="md-nav__link" for="__nav_5_3_1" id="__nav_5_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tasks
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3_1">
            <span class="md-nav__icon md-icon"></span>
            Tasks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/nlp/question_answering/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Question Answering
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Reading Lists
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Reading Lists
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../readinglist/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reading Lists
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../readinglist/mode_connectivity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mode Connectivity
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-eight-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      The Eight Tasks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The Eight Tasks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#performance-of-the-fine-tuned-models" class="md-nav__link">
    <span class="md-ellipsis">
      Performance of the Fine-tuned Models
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model-pool-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Model Pool Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lora-and-l-lora" class="md-nav__link">
    <span class="md-ellipsis">
      LoRA and L-LoRA
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Basic Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inspection-of-model-information" class="md-nav__link">
    <span class="md-ellipsis">
      Inspection of Model Information
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#single-model-evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      Single Model Evaluation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simple-averaging" class="md-nav__link">
    <span class="md-ellipsis">
      Simple Averaging
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fisher-merging" class="md-nav__link">
    <span class="md-ellipsis">
      Fisher Merging
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#regmean" class="md-nav__link">
    <span class="md-ellipsis">
      RegMean
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-arithmetic" class="md-nav__link">
    <span class="md-ellipsis">
      Task Arithmetic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ties-merging" class="md-nav__link">
    <span class="md-ellipsis">
      Ties-Merging
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adamerging" class="md-nav__link">
    <span class="md-ellipsis">
      AdaMerging
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weight-ensembling-moe" class="md-nav__link">
    <span class="md-ellipsis">
      Weight-Ensembling MoE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#experimental-results" class="md-nav__link">
    <span class="md-ellipsis">
      Experimental Results
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scope" class="md-nav__link">
    <span class="md-ellipsis">
      Scope
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Scope">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#task-vector-cosine-similarity" class="md-nav__link">
    <span class="md-ellipsis">
      Task Vector Cosine Similarity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generalization-and-robustness-evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      Generalization and Robustness Evaluation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#experimental-results_1" class="md-nav__link">
    <span class="md-ellipsis">
      Experimental Results
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
    <nav class="md-nav" aria-label="References">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fusion_bench.modelpool.clip_vision" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;clip_vision
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" clip_vision">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fusion_bench.modelpool.clip_vision.modelpool" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;modelpool
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" modelpool">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fusion_bench.modelpool.clip_vision.modelpool.CLIPVisionModelPool" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;CLIPVisionModelPool
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fusion_bench.models.linearized.vision_model" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;vision_model
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" vision_model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fusion_bench.models.linearized.vision_model.linearize_lora_model_" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;linearize_lora_model_
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fusion_bench.models.linearized.vision_model.load_fft_vision_model_hf" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;load_fft_vision_model_hf
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" load_fft_vision_model_hf">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fusion_bench.models.linearized.vision_model.load_fft_vision_model_hf(model_name)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;model_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fusion_bench.models.linearized.vision_model.load_fft_vision_model_hf(return_vison_model)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;return_vison_model
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fusion_bench.models.linearized.vision_model.load_l_lora_vision_model_hf" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;load_l_lora_vision_model_hf
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fusion_bench.models.linearized.vision_model.load_lora_vision_model_hf" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;load_lora_vision_model_hf
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" load_lora_vision_model_hf">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fusion_bench.models.linearized.vision_model.load_lora_vision_model_hf(base_model_name)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;base_model_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fusion_bench.models.linearized.vision_model.load_lora_vision_model_hf(peft_name)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;peft_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fusion_bench.models.linearized.vision_model.load_lora_vision_model_hf(merge_and_unload)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;merge_and_unload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fusion_bench.models.linearized.vision_model.load_lora_vision_model_hf(return_vison_model)" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;return_vison_model
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="clip-vit-models-for-open-vocabulary-image-classification">CLIP-ViT Models for Open Vocabulary Image Classification<a class="headerlink" href="#clip-vit-models-for-open-vocabulary-image-classification" title="Permanent link">&para;</a></h1>
<p>Here we provides a list of CLIP-ViT models that are trained for open vocabulary image classification. </p>
<h2 id="the-eight-tasks">The Eight Tasks<a class="headerlink" href="#the-eight-tasks" title="Permanent link">&para;</a></h2>
<p>The most common eight tasks used in the research community are SUN397, Cars, RESISC45, EuroSAT, SVHN, GTSRB, MNIST, and DTD.
These tasks cover a wide range of domains, including natural images, satellite images, and digit recognition.
You can download the datasets from <a href="https://huggingface.co/collections/tanganke/the-eight-image-classification-tasks-6644ce0376c0a469f6928507">this HuggingFace Collection</a> or using the <code>datasets</code> library as follows:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datasets</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_dataset</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="c1"># take `gtsrb` as an example</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="n">dataset</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="s2">&quot;tanganke/gtsrb&quot;</span><span class="p">)</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="n">train_dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">]</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="n">test_dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">]</span>
</span></code></pre></div>
<p>The authors of Task Arithmetic have fine-tuned the CLIP-ViT models from the <em>open_clip</em> library on these eight tasks and provide the models publicly on <a href="https://drive.google.com/drive/folders/1u_Tva6x0p6oxu5Eo0ZZsf-520Cc_3MKw?usp=share_link">Google Drive</a>. 
However, these models rely on a specific version of the <em>open_clip</em> library. </p>
<p>To make experiments more convenient and avoid dependency on a specific library version, we have re-trained these models and made them publicly available on the HuggingFace Model Hub.
We use the Adam Optimizer with a fixed learning rate of 1e-5 over 4000 training steps (batch_size=32).
Only the vision encoder is fine-tuned, while the text encoder remains fixed to preserve the open-vocabulary property of the model.</p>
<ul>
<li><a href="https://huggingface.co/collections/tanganke/clip-vit-b-32-on-the-eight-image-classication-tasks-6644d0c476c0a469f693cf91">fine-tuned CLIP-ViT-B/32 models</a></li>
<li><a href="https://huggingface.co/collections/tanganke/clip-vit-b-16-on-the-eight-image-classification-tasks-66cd54d8332ce5c7468ab5f8">fine-tuned CLIP-ViT-B/16 models</a></li>
<li><a href="https://huggingface.co/collections/tanganke/clip-vit-l-14-on-the-eight-image-classification-tasks-6644d2b014331c746683de63">fine-tuned CLIP-ViT-L/14 models</a></li>
</ul>
<p>To use these models, you can load them from the Transformers library as follows:</p>
<p>load vision backbone</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">transformers</span><span class="w"> </span><span class="kn">import</span> <span class="n">CLIPVisionModel</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="c1"># load the CLIP-ViT-B/32 model, take `gtsrb` as an example</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="n">vision_model</span> <span class="o">=</span> <span class="n">CLIPVisionModel</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s1">&#39;tanganke/clip-vit-base-patch32_gtsrb&#39;</span><span class="p">)</span>
</span></code></pre></div>
<p>substitute the vision encoder of clip</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">transformers</span><span class="w"> </span><span class="kn">import</span> <span class="n">CLIPProcessor</span><span class="p">,</span> <span class="n">CLIPModel</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="c1"># load pre-trained CLIP model</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="n">clip_model</span> <span class="o">=</span> <span class="n">CLIPModel</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;openai/clip-vit-base-patch32&quot;</span><span class="p">)</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="c1"># substitute the vision model with the fine-tuned one</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="n">clip_model</span><span class="o">.</span><span class="n">vision_model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">vision_model</span><span class="o">.</span><span class="n">vision_model</span><span class="o">.</span><span class="n">state_dict</span><span class="p">())</span>
</span></code></pre></div>
<h3 id="performance-of-the-fine-tuned-models">Performance of the Fine-tuned Models<a class="headerlink" href="#performance-of-the-fine-tuned-models" title="Permanent link">&para;</a></h3>
<p>evaluate the fine-tuned CLIP-ViT-B/32 models on the eight tasks:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1"># evaluate singlue fine-tuned models</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="k">for</span><span class="w"> </span>task<span class="w"> </span><span class="k">in</span><span class="w"> </span>sun397<span class="w"> </span>stanford-cars<span class="w"> </span>resisc45<span class="w"> </span>eurosat<span class="w"> </span>svhn<span class="w"> </span>gtsrb<span class="w"> </span>mnist<span class="w"> </span>dtd
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="k">do</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">    </span>fusion_bench<span class="w"> </span><span class="nv">method</span><span class="o">=</span>dummy<span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">        </span><span class="nv">modelpool</span><span class="o">=</span>clip-vit-base-patch32_individual<span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">            </span>modelpool.models.0.path<span class="o">=</span>tanganke/clip-vit-base-patch32_<span class="si">${</span><span class="nv">task</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">        </span><span class="nv">taskpool</span><span class="o">=</span>clip-vit-classification_TA8<span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">        </span><span class="nv">report_save_path</span><span class="o">=</span><span class="s2">&quot;outputs/ViT-B-32/single-task/clip-vit-base-patch32_</span><span class="si">${</span><span class="nv">task</span><span class="si">}</span><span class="s2">.json&quot;</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="k">done</span>
</span></code></pre></div>
<p>evaluate the fine-tuned CLIP-ViT-L/14 models on the eight tasks:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># assume you have eight GPUs, and you can evaluate the models on the eight tasks in parallel</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="nv">tasks</span><span class="o">=(</span>sun397<span class="w"> </span>stanford-cars<span class="w"> </span>resisc45<span class="w"> </span>eurosat<span class="w"> </span>svhn<span class="w"> </span>gtsrb<span class="w"> </span>mnist<span class="w"> </span>dtd<span class="o">)</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="nv">CUDA_DEVICES</span><span class="o">=(</span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">7</span><span class="o">)</span><span class="w">  </span><span class="c1"># List of CUDA devices to use</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="p">!CUDA_DEVICES[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">    </span><span class="nv">task</span><span class="o">=</span><span class="si">${</span><span class="nv">tasks</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="si">}</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">    </span><span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="si">${</span><span class="nv">CUDA_DEVICES</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="si">}</span><span class="w"> </span>fusion_bench<span class="w"> </span><span class="nv">method</span><span class="o">=</span>dummy<span class="w"> </span><span class="se">\</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">        </span><span class="nv">modelpool</span><span class="o">=</span>clip-vit-large-patch14_individual<span class="w"> </span><span class="se">\</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">            </span>modelpool.models.0.path<span class="o">=</span>tanganke/clip-vit-large-patch14_<span class="si">${</span><span class="nv">task</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">        </span><span class="nv">taskpool</span><span class="o">=</span>clip-vit-classification_TA8<span class="w"> </span><span class="se">\</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">            </span>taskpool.clip_model<span class="o">=</span>openai/clip-vit-large-patch14<span class="w"> </span><span class="se">\</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">        </span><span class="nv">report_save_path</span><span class="o">=</span><span class="s2">&quot;outputs/ViT-L-14/single-task/clip-vit-large-patch14_</span><span class="si">${</span><span class="nv">task</span><span class="si">}</span><span class="s2">.json&quot;</span><span class="w"> </span><span class="p">&amp;</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="k">done</span>
</span></code></pre></div>
<div class="tabbed-set tabbed-alternate" data-tabs="1:3"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><input id="__tabbed_1_3" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Performance of the fine-tuned CLIP-ViT-B/32 models</label><label for="__tabbed_1_2">Performance of the fine-tuned CLIP-ViT-B/16 models</label><label for="__tabbed_1_3">Performance of the fine-tuned CLIP-ViT-L/14 models</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Model</th>
<th>SUN397</th>
<th>Cars</th>
<th>RESISC45</th>
<th>EuroSAT</th>
<th>SVHN</th>
<th>GTSRB</th>
<th>MNIST</th>
<th>DTD</th>
<th>Average</th>
</tr>
</thead>
<tbody>
<tr>
<td>Pre-trained</td>
<td>63.2</td>
<td>59.8</td>
<td>60.7</td>
<td>46.0</td>
<td>31.6</td>
<td>32.5</td>
<td>48.3</td>
<td>43.9</td>
<td>48.2</td>
</tr>
<tr>
<td>SUN397</td>
<td><strong>75.0</strong></td>
<td>47.0</td>
<td>54.3</td>
<td>46.5</td>
<td>28.3</td>
<td>26.4</td>
<td>44.3</td>
<td>41.6</td>
<td>45.4</td>
</tr>
<tr>
<td>Cars</td>
<td>56.6</td>
<td><strong>78.3</strong></td>
<td>50.9</td>
<td>38.4</td>
<td>30.2</td>
<td>30.6</td>
<td>49.7</td>
<td>41.8</td>
<td>47.1</td>
</tr>
<tr>
<td>RESISC45</td>
<td>52.0</td>
<td>47.2</td>
<td><strong>95.2</strong></td>
<td>56.9</td>
<td>23.9</td>
<td>24.3</td>
<td>39.7</td>
<td>35.9</td>
<td>46.9</td>
</tr>
<tr>
<td>EuroSAT</td>
<td>49.0</td>
<td>39.9</td>
<td>33.5</td>
<td><strong>99.0</strong></td>
<td>11.8</td>
<td>22.9</td>
<td>33.8</td>
<td>35.5</td>
<td>40.7</td>
</tr>
<tr>
<td>SVHN</td>
<td>40.5</td>
<td>36.3</td>
<td>18.9</td>
<td>9.8</td>
<td><strong>97.3</strong></td>
<td>27.3</td>
<td>81.8</td>
<td>23.2</td>
<td>41.9</td>
</tr>
<tr>
<td>GTSRB</td>
<td>36.8</td>
<td>33.0</td>
<td>20.6</td>
<td>21.3</td>
<td>41.2</td>
<td><strong>98.9</strong></td>
<td>30.9</td>
<td>23.9</td>
<td>38.3</td>
</tr>
<tr>
<td>MNIST</td>
<td>50.3</td>
<td>40.0</td>
<td>31.3</td>
<td>17.7</td>
<td>50.1</td>
<td>19.3</td>
<td><strong>99.6</strong></td>
<td>30.7</td>
<td>42.4</td>
</tr>
<tr>
<td>DTD</td>
<td>54.6</td>
<td>51.3</td>
<td>36.9</td>
<td>25.0</td>
<td>28.9</td>
<td>21.8</td>
<td>47.3</td>
<td><strong>79.7</strong></td>
<td>43.2</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Model</th>
<th>SUN397</th>
<th>Cars</th>
<th>RESISC45</th>
<th>EuroSAT</th>
<th>SVHN</th>
<th>GTSRB</th>
<th>MNIST</th>
<th>DTD</th>
<th>Average</th>
</tr>
</thead>
<tbody>
<tr>
<td>SUN397</td>
<td><strong>78.9</strong></td>
<td>56.2</td>
<td>58.9</td>
<td>46.6</td>
<td>42.7</td>
<td>39.9</td>
<td>59.3</td>
<td>40.8</td>
<td>52.9</td>
</tr>
<tr>
<td>Cars</td>
<td>62.2</td>
<td><strong>85.9</strong></td>
<td>60.8</td>
<td>48.7</td>
<td>47.1</td>
<td>44.8</td>
<td>61.6</td>
<td>43.2</td>
<td>56.8</td>
</tr>
<tr>
<td>RESISC45</td>
<td>60.5</td>
<td>57.8</td>
<td><strong>96.6</strong></td>
<td>65.7</td>
<td>28.4</td>
<td>35.6</td>
<td>71.5</td>
<td>39.0</td>
<td>56.9</td>
</tr>
<tr>
<td>EuroSAT</td>
<td>58.3</td>
<td>59.2</td>
<td>37.4</td>
<td><strong>99.0</strong></td>
<td>40.5</td>
<td>38.9</td>
<td>57.4</td>
<td>37.7</td>
<td>53.6</td>
</tr>
<tr>
<td>SVHN</td>
<td>57.6</td>
<td>55.4</td>
<td>42.8</td>
<td>19.6</td>
<td><strong>97.6</strong></td>
<td>32.6</td>
<td>90.0</td>
<td>33.1</td>
<td>53.6</td>
</tr>
<tr>
<td>GTSRB</td>
<td>54.0</td>
<td>50.5</td>
<td>25.3</td>
<td>13.2</td>
<td>52.0</td>
<td><strong>99.0</strong></td>
<td>56.9</td>
<td>33.9</td>
<td>48.1</td>
</tr>
<tr>
<td>MNIST</td>
<td>58.7</td>
<td>52.4</td>
<td>47.0</td>
<td>23.6</td>
<td>65.0</td>
<td>27.6</td>
<td><strong>99.7</strong></td>
<td>37.7</td>
<td>51.5</td>
</tr>
<tr>
<td>DTD</td>
<td>57.7</td>
<td>58.1</td>
<td>53.5</td>
<td>43.0</td>
<td>44.2</td>
<td>36.2</td>
<td>70.4</td>
<td><strong>82.3</strong></td>
<td>55.7</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Model</th>
<th>SUN397</th>
<th>Cars</th>
<th>RESISC45</th>
<th>EuroSAT</th>
<th>SVHN</th>
<th>GTSRB</th>
<th>MNIST</th>
<th>DTD</th>
<th>Average</th>
</tr>
</thead>
<tbody>
<tr>
<td>Pre-trained</td>
<td>68.3</td>
<td>77.8</td>
<td>71.0</td>
<td>58.9</td>
<td>58.4</td>
<td>50.6</td>
<td>76.4</td>
<td>55.5</td>
<td>64.6</td>
</tr>
<tr>
<td>SUN397</td>
<td><strong>82.8</strong></td>
<td>68.4</td>
<td>58.1</td>
<td>49.9</td>
<td>55.0</td>
<td>46.3</td>
<td>79.5</td>
<td>52.8</td>
<td>61.6</td>
</tr>
<tr>
<td>Cars</td>
<td>67.8</td>
<td><strong>92.9</strong></td>
<td>68.7</td>
<td>56.4</td>
<td>51.7</td>
<td>47.7</td>
<td>80.5</td>
<td>55.6</td>
<td>65.2</td>
</tr>
<tr>
<td>RESISC45</td>
<td>65.6</td>
<td>69.0</td>
<td><strong>97.4</strong></td>
<td>64.3</td>
<td>38.3</td>
<td>46.6</td>
<td>77.7</td>
<td>49.9</td>
<td>63.6</td>
</tr>
<tr>
<td>EuroSAT</td>
<td>65.2</td>
<td>69.0</td>
<td>40.6</td>
<td><strong>99.2</strong></td>
<td>33.4</td>
<td>45.6</td>
<td>73.5</td>
<td>47.1</td>
<td>59.2</td>
</tr>
<tr>
<td>SVHN</td>
<td>66.4</td>
<td>69.0</td>
<td>54.0</td>
<td>19.7</td>
<td><strong>97.9</strong></td>
<td>48.7</td>
<td>92.2</td>
<td>50.1</td>
<td>62.3</td>
</tr>
<tr>
<td>GTSRB</td>
<td>63.4</td>
<td>64.8</td>
<td>38.7</td>
<td>19.6</td>
<td>71.0</td>
<td><strong>99.2</strong></td>
<td>75.1</td>
<td>45.8</td>
<td>59.7</td>
</tr>
<tr>
<td>MNIST</td>
<td>56.0</td>
<td>49.8</td>
<td>53.5</td>
<td>26.6</td>
<td>48.2</td>
<td>33.1</td>
<td><strong>99.8</strong></td>
<td>47.1</td>
<td>51.7</td>
</tr>
<tr>
<td>DTD</td>
<td>66.8</td>
<td>75.3</td>
<td>65.5</td>
<td>43.7</td>
<td>49.5</td>
<td>45.0</td>
<td>68.5</td>
<td><strong>85.5</strong></td>
<td>62.5</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<h3 id="model-pool-configuration">Model Pool Configuration<a class="headerlink" href="#model-pool-configuration" title="Permanent link">&para;</a></h3>
<p>To use these models from our FusionBench library, you can specify the modelpool configuration file as follows:</p>
<div class="language-yaml highlight"><span class="filename">config/modelpool/CLIPVisionModelPool/clip-vit-base-patch32_TA8.yaml</span><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nt">defaults</span><span class="p">:</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">CLIPVisionModelPool@</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_template</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">/model/clip-vit@models</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">clip-vit-base-patch32_eight_tasks</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">/dataset/image_classification/train@train_datasets</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">the_eight_tasks</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">/dataset/image_classification/test@test_datasets</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">the_eight_tasks</span>
</span></code></pre></div>
<p>The configuration uses YAML's inheritance feature with the defaults key.
It inherits from a template (<code>_template.yaml</code>) and overrides specific values.
Some values are set to <code>???</code> or null, indicating that they need to be specified or can be optionally set when using this configuration.
This configuration structure allows for modular and reusable setups, making it easier to manage different model configurations within the FusionBench library.</p>
<div class="language-yaml highlight"><span class="filename">config/modelpool/CLIPVisionModelPool/_template.yaml</span><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nt">_usage_</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">  </span><span class="no">defaults:</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">    </span><span class="no">- CLIPVisionModelPool@: _template</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="nt">_target_</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fusion_bench.modelpool.CLIPVisionModelPool</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="nt">_version_</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0.2&quot;</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="nt">_recursive_</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="nt">models</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">???</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="nt">train_datasets</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="nt">test_datasets</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="nt">processor</span><span class="p">:</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="w">  </span><span class="nt">_target_</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">transformers.CLIPProcessor.from_pretrained</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="w">  </span><span class="nt">pretrained_model_name_or_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openai/clip-vit-base-patch32</span>
</span></code></pre></div>
<p>The type of the modelpool is <code>fusion_bench.modelpool.CLIPVisionModelPool</code>.</p>
<h3 id="lora-and-l-lora">LoRA and L-LoRA<a class="headerlink" href="#lora-and-l-lora" title="Permanent link">&para;</a></h3>
<p>Here we fine-tuned the CLIP-ViT-B/16 models on the eight image classification tasks using the LoRA and L-LoRA methods.
<code>q_proj</code> and <code>v_proj</code> are fine-tuned with a learning rate of 1e-5 using the Adam optimizer for 2000 steps.
You can find the script for fine-tuning the models at <code>examples/clip_finetune/clip_finetune.sh</code>.</p>
<ul>
<li><a href="https://huggingface.co/collections/tanganke/clip-vit-b-16-on-the-eight-image-classification-tasks-lora-66cd554ee7829e9dbb236c29">CLIP-ViT-B/16 on the eight image classification tasks (LoRA)</a></li>
<li><a href="https://huggingface.co/collections/tanganke/clip-vit-b-16-on-eight-image-classification-tasks-l-lora-66cd5b0e332ce5c7468d1bc6">CLIP-ViT-B/16 on eight image classification tasks (L-LoRA)</a></li>
</ul>
<p>Load LoRA models (see <a class="autorefs autorefs-internal" title="            load_lora_vision_model_hf(base_model_name, peft_name, merge_and_unload=False, return_vison_model=True)" href="#fusion_bench.models.linearized.vision_model.load_lora_vision_model_hf">load_lora_vision_model_hf</a>):</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">base_model</span> <span class="o">=</span> <span class="n">CLIPVisionModel</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s1">&#39;openai/clip-vit-base-patch16&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">vision_model</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="n">model</span> <span class="o">=</span> <span class="n">PeftModel</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">base_model</span><span class="p">,</span> <span class="n">peft_model_id</span><span class="p">)</span>
</span></code></pre></div>
<p>Load L-LoRA models, refer to <a class="autorefs autorefs-internal" title="            load_l_lora_vision_model_hf(base_model_name, peft_name)" href="#fusion_bench.models.linearized.vision_model.load_l_lora_vision_model_hf">load_l_lora_vision_model_hf</a>.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">Performance of the fine-tuned CLIP-ViT-B/16 models (LoRA-16)</label><label for="__tabbed_2_2">Performance of the fine-tuned CLIP-ViT-B/16 models (L-LoRA-16)</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Model</th>
<th>SUN397</th>
<th>Cars</th>
<th>RESISC45</th>
<th>EuroSAT</th>
<th>SVHN</th>
<th>GTSRB</th>
<th>MNIST</th>
<th>DTD</th>
<th>Average</th>
</tr>
</thead>
<tbody>
<tr>
<td>SUN397</td>
<td><strong>70.8</strong></td>
<td>64.8</td>
<td>66.7</td>
<td>55.4</td>
<td>51.8</td>
<td>44.0</td>
<td>52.2</td>
<td>46.0</td>
<td>56.5</td>
</tr>
<tr>
<td>Cars</td>
<td>65.8</td>
<td><strong>72.3</strong></td>
<td>65.7</td>
<td>54.5</td>
<td>52.3</td>
<td>44.1</td>
<td>54.1</td>
<td>45.3</td>
<td>56.8</td>
</tr>
<tr>
<td>RESISC45</td>
<td>66.2</td>
<td>64.6</td>
<td><strong>88.9</strong></td>
<td>65.4</td>
<td>51.8</td>
<td>43.6</td>
<td>54.7</td>
<td>45.6</td>
<td>60.1</td>
</tr>
<tr>
<td>EuroSAT</td>
<td>65.6</td>
<td>64.6</td>
<td>59.4</td>
<td><strong>97.1</strong></td>
<td>48.2</td>
<td>43.6</td>
<td>60.5</td>
<td>46.0</td>
<td>60.6</td>
</tr>
<tr>
<td>SVHN</td>
<td>65.5</td>
<td>64.1</td>
<td>65.3</td>
<td>39.1</td>
<td><strong>93.2</strong></td>
<td>45.5</td>
<td>83.0</td>
<td>45.1</td>
<td>62.6</td>
</tr>
<tr>
<td>GTSRB</td>
<td>65.5</td>
<td>63.9</td>
<td>64.2</td>
<td>28.6</td>
<td>56.9</td>
<td><strong>91.0</strong></td>
<td>71.3</td>
<td>45.5</td>
<td>60.9</td>
</tr>
<tr>
<td>MNIST</td>
<td>65.3</td>
<td>64.1</td>
<td>65.7</td>
<td>51.9</td>
<td>57.6</td>
<td>46.6</td>
<td><strong>98.4</strong></td>
<td>45.2</td>
<td>61.9</td>
</tr>
<tr>
<td>DTD</td>
<td>64.5</td>
<td>64.2</td>
<td>61.0</td>
<td>49.1</td>
<td>54.2</td>
<td>44.2</td>
<td>68.0</td>
<td><strong>67.9</strong></td>
<td>59.1</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Model</th>
<th>SUN397</th>
<th>Cars</th>
<th>RESISC45</th>
<th>EuroSAT</th>
<th>SVHN</th>
<th>GTSRB</th>
<th>MNIST</th>
<th>DTD</th>
<th>Average</th>
</tr>
</thead>
<tbody>
<tr>
<td>SUN397</td>
<td><strong>69.0</strong></td>
<td>65.0</td>
<td>66.7</td>
<td>56.0</td>
<td>52.6</td>
<td>44.0</td>
<td>53.3</td>
<td>45.4</td>
<td>56.5</td>
</tr>
<tr>
<td>Cars</td>
<td>65.8</td>
<td><strong>69.7</strong></td>
<td>65.7</td>
<td>54.4</td>
<td>52.0</td>
<td>43.7</td>
<td>52.6</td>
<td>45.3</td>
<td>56.2</td>
</tr>
<tr>
<td>RESISC45</td>
<td>65.9</td>
<td>64.3</td>
<td><strong>83.6</strong></td>
<td>66.3</td>
<td>51.7</td>
<td>43.4</td>
<td>51.9</td>
<td>45.6</td>
<td>59.1</td>
</tr>
<tr>
<td>EuroSAT</td>
<td>65.5</td>
<td>64.8</td>
<td>64.2</td>
<td><strong>95.4</strong></td>
<td>50.7</td>
<td>43.8</td>
<td>58.4</td>
<td>45.9</td>
<td>61.1</td>
</tr>
<tr>
<td>SVHN</td>
<td>65.3</td>
<td>64.4</td>
<td>65.2</td>
<td>46.6</td>
<td><strong>90.1</strong></td>
<td>45.8</td>
<td>80.0</td>
<td>45.4</td>
<td>62.9</td>
</tr>
<tr>
<td>GTSRB</td>
<td>65.5</td>
<td>64.4</td>
<td>64.2</td>
<td>43.8</td>
<td>59.5</td>
<td><strong>78.6</strong></td>
<td>72.6</td>
<td>45.2</td>
<td>61.7</td>
</tr>
<tr>
<td>MNIST</td>
<td>65.3</td>
<td>64.5</td>
<td>65.0</td>
<td>53.3</td>
<td>57.6</td>
<td>45.6</td>
<td><strong>96.4</strong></td>
<td>45.5</td>
<td>61.7</td>
</tr>
<tr>
<td>DTD</td>
<td>65.7</td>
<td>64.7</td>
<td>65.9</td>
<td>54.5</td>
<td>51.6</td>
<td>44.4</td>
<td>58.2</td>
<td><strong>56.2</strong></td>
<td>57.7</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><img alt="alt text" src="../images/clip-vit-base-patch16_full%26lora%26l-lora.png" width="1000px" />
<img alt="alt text" src="../images/clip-vit-base-patch16_full%26lora%26l-lora_average.png" width="1000px" /></p>
<h2 id="basic-examples">Basic Examples<a class="headerlink" href="#basic-examples" title="Permanent link">&para;</a></h2>
<p>Here are some basic examples of using the CLIP-ViT models for open vocabulary image classification with different fusion methods, using the <a href="../../cli/fusion_bench/"><code>fusion_bench</code></a> command line interface.</p>
<h3 id="inspection-of-model-information">Inspection of Model Information<a class="headerlink" href="#inspection-of-model-information" title="Permanent link">&para;</a></h3>
<p>Print the basic information of the CLIP-ViT-B/32 model and CLIP-ViT-L/14 model</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>fusion_bench<span class="w"> </span><span class="se">\</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">  </span><span class="nv">method</span><span class="o">=</span>dummy<span class="w"> </span><span class="se">\</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">  </span><span class="nv">modelpool</span><span class="o">=</span>CLIPVisionModelPool/clip-vit-base-patch32_individual<span class="w"> </span><span class="se">\</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">  </span><span class="nv">taskpool</span><span class="o">=</span>dummy<span class="w">  </span><span class="c1"># a dummy task that just report the basic information of model (e.g., number of parameters)</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="c1"># Output:</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="c1"># {&#39;model_info&#39;: {&#39;trainable_params&#39;: 87456000, &#39;all_params&#39;: 87456000, &#39;trainable_percentage&#39;: 1.0}}</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="c1"># or use the following command to inspect the CLIP-ViT-L/14 model</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>fusion_bench<span class="w"> </span><span class="se">\</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="w">  </span><span class="nv">method</span><span class="o">=</span>dummy<span class="w"> </span><span class="se">\</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="w">  </span><span class="nv">modelpool</span><span class="o">=</span>CLIPVisionModelPool/clip-vit-large-patch14_individual<span class="w"> </span><span class="se">\</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="w">  </span><span class="nv">taskpool</span><span class="o">=</span>dummy
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="c1"># Output:</span>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="c1"># {&#39;model_info&#39;: {&#39;trainable_params&#39;: 303179776, &#39;all_params&#39;: 303179776, &#39;trainable_percentage&#39;: 1.0}}</span>
</span></code></pre></div>
<h3 id="single-model-evaluation">Single Model Evaluation<a class="headerlink" href="#single-model-evaluation" title="Permanent link">&para;</a></h3>
<p>evaluate a single CLIP-ViT-B/32 model on the eight downstream tasks:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="nv">path_to_clip_model</span><span class="o">=</span><span class="s2">&quot;tanganke/clip-vit-base-patch32_sun397&quot;</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>fusion_bench<span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">  </span><span class="nv">method</span><span class="o">=</span>dummy<span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">  </span><span class="nv">modelpool</span><span class="o">=</span>CLIPVisionModelPool/clip-vit-base-patch32_individual<span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">    </span>modelpool.models._pretrained_.pretrained_model_name_or_path<span class="o">=</span><span class="s2">&quot;&#39;</span><span class="si">${</span><span class="nv">path_to_clip_model</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">  </span><span class="nv">taskpool</span><span class="o">=</span>CLIPVisionModelTaskPool/clip-vit-classification_TA8
</span></code></pre></div>
<p>Here:</p>
<ul>
<li>The <code>dummy</code> method is a special method used to skip the model merging process, it loads the pre-trained model in the modelpool and return the model without any modification (or the first model when a model with the name <code>_pretrained_</code> does not exist in modelpool), see <a href="../../algorithms/dummy/">dummy method</a> for more information. </li>
<li>The <code>CLIPVisionModelPool/clip-vit-base-patch32_individual</code> modelpool contains a single model. By passing argument <code>modelpool.models.0.path=...</code>, we override the path of the model with the specified path.
<div class="language-yaml highlight"><span class="filename">config/modelpool/CLIPVisionModelPool/clip-vit-base-patch32_individual.yaml</span><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="nt">defaults</span><span class="p">:</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">CLIPVisionModelPool@</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_template</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="nt">models</span><span class="p">:</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">  </span><span class="nt">_pretrained_</span><span class="p">:</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">    </span><span class="nt">_target_</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">transformers.CLIPVisionModel.from_pretrained</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">    </span><span class="nt">pretrained_model_name_or_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${...base_model}</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="nt">processor</span><span class="p">:</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="w">  </span><span class="nt">_target_</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">transformers.CLIPProcessor.from_pretrained</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">  </span><span class="nt">pretrained_model_name_or_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${..base_model}</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="nt">base_model</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openai/clip-vit-base-patch32</span>
</span></code></pre></div></li>
<li>The <code>CLIPVisionModelTaskPool/clip-vit-classification_TA8</code> taskpool is used to evaluate the model on the eight tasks.
  if <code>$path_to_clip_model</code> is not specified, the pre-trained model from HuggingFace will be used by default.
<div class="language-yaml highlight"><span class="filename">config/taskpool/CLIPVisionModelTaskPool/clip-vit-classification_TA8.yaml</span><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="nt">defaults</span><span class="p">:</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">CLIPVisionModelTaskPool@</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_template</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">/dataset/image_classification/test@test_datasets</span><span class="p">:</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sun397</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">stanford-cars</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">resisc45</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eurosat</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">svhn</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gtsrb</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mnist</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dtd</span>
</span></code></pre></div></li>
</ul>
<p>Use a for loop to evaluate multiple CLIP-ViT-B/32 model on the eight tasks, and save reports to json files:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">for</span><span class="w"> </span>task<span class="w"> </span><span class="k">in</span><span class="w"> </span>sun397<span class="w"> </span>stanford-cars<span class="w"> </span>resisc45<span class="w"> </span>eurosat<span class="w"> </span>svhn<span class="w"> </span>gtsrb<span class="w"> </span>mnist<span class="w"> </span>dtd
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="k">do</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">    </span>fusion_bench<span class="w"> </span><span class="nv">method</span><span class="o">=</span>dummy<span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">        </span><span class="nv">modelpool</span><span class="o">=</span>CLIPVisionModelPool/clip-vit-base-patch32_individual<span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="w">            </span>modelpool.models._pretrained_.pretrained_model_name_or_path<span class="o">=</span>tanganke/clip-vit-base-patch32_<span class="si">${</span><span class="nv">task</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="w">        </span><span class="nv">taskpool</span><span class="o">=</span>CLIPVisionModelTaskPool/clip-vit-classification_TA8<span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="w">        </span><span class="nv">report_save_path</span><span class="o">=</span><span class="s2">&quot;outputs/ViT-B-32/single-task/clip-vit-base-patch32_</span><span class="si">${</span><span class="nv">task</span><span class="si">}</span><span class="s2">.json&quot;</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="k">done</span>
</span></code></pre></div>
<p>evaluate the CLIP-ViT-L/14 model on the eight tasks</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>fusion_bench<span class="w"> </span><span class="nv">method</span><span class="o">=</span>dummy<span class="w"> </span><span class="se">\</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">  </span><span class="nv">modelpool</span><span class="o">=</span>CLIPVisionModelPool/clip-vit-large-patch14_individual<span class="w"> </span><span class="se">\</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">    </span>modelpool.models._pretrained_.pretrained_model_name_or_path<span class="o">=</span><span class="s2">&quot;&#39;</span><span class="si">${</span><span class="nv">path_to_clip_model</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">  </span><span class="nv">taskpool</span><span class="o">=</span>CLIPVisionModelTaskPool/clip-vit-classification_TA8_L14
</span></code></pre></div>
<h3 id="simple-averaging">Simple Averaging<a class="headerlink" href="#simple-averaging" title="Permanent link">&para;</a></h3>
<p>merge CLIP-ViT-B/32 models using simple average and evaluate on the eight tasks</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>fusion_bench<span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">  </span><span class="nv">method</span><span class="o">=</span>simple_average<span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w">  </span><span class="nv">modelpool</span><span class="o">=</span>CLIPVisionModelPool/clip-vit-base-patch32_TA8_model_only<span class="w"> </span><span class="se">\</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="w">  </span><span class="nv">taskpool</span><span class="o">=</span>CLIPVisionModelTaskPool/clip-vit-classification_TA8<span class="w"> </span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="c1"># results</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="o">{</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="w">    </span><span class="s2">&quot;svhn&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;accuracy&quot;</span>:<span class="w"> </span><span class="m">0</span>.6451674699783325,<span class="w"> </span><span class="s2">&quot;loss&quot;</span>:<span class="w"> </span><span class="m">1</span>.128771424293518<span class="o">}</span>,
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="w">    </span><span class="s2">&quot;stanford_cars&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;accuracy&quot;</span>:<span class="w"> </span><span class="m">0</span>.625668466091156,<span class="w"> </span><span class="s2">&quot;loss&quot;</span>:<span class="w"> </span><span class="m">1</span>.135254979133606<span class="o">}</span>,
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="w">    </span><span class="s2">&quot;resisc45&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;accuracy&quot;</span>:<span class="w"> </span><span class="m">0</span>.7079365253448486,<span class="w"> </span><span class="s2">&quot;loss&quot;</span>:<span class="w"> </span><span class="m">0</span>.9697789549827576<span class="o">}</span>,
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="w">    </span><span class="s2">&quot;eurosat&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;accuracy&quot;</span>:<span class="w"> </span><span class="m">0</span>.7685185074806213,<span class="w"> </span><span class="s2">&quot;loss&quot;</span>:<span class="w"> </span><span class="m">0</span>.6301173567771912<span class="o">}</span>,
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="w">    </span><span class="s2">&quot;gtsrb&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;accuracy&quot;</span>:<span class="w"> </span><span class="m">0</span>.5494061708450317,<span class="w"> </span><span class="s2">&quot;loss&quot;</span>:<span class="w"> </span><span class="m">1</span>.492265224456787<span class="o">}</span>,
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="w">    </span><span class="s2">&quot;mnist&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;accuracy&quot;</span>:<span class="w"> </span><span class="m">0</span>.8626000285148621,<span class="w"> </span><span class="s2">&quot;loss&quot;</span>:<span class="w"> </span><span class="m">0</span>.5933865308761597<span class="o">}</span>,
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="w">    </span><span class="s2">&quot;dtd&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;accuracy&quot;</span>:<span class="w"> </span><span class="m">0</span>.5090425610542297,<span class="w"> </span><span class="s2">&quot;loss&quot;</span>:<span class="w"> </span><span class="m">1</span>.79731023311615<span class="o">}</span>,
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="w">    </span><span class="s2">&quot;sun397&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;accuracy&quot;</span>:<span class="w"> </span><span class="m">0</span>.6543576717376709,<span class="w"> </span><span class="s2">&quot;loss&quot;</span>:<span class="w"> </span><span class="m">1</span>.1993952989578247<span class="o">}</span>,
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a><span class="o">}</span>
</span></code></pre></div>
<p>merge CLIP-ViT-L/14 models using simple average and evaluate on the eight tasks</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>fusion_bench<span class="w"> </span><span class="nv">method</span><span class="o">=</span>simple_average<span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="w">  </span><span class="nv">modelpool</span><span class="o">=</span>CLIPVisionModelPool/clip-vit-large-patch14_TA8_model_only<span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="w">  </span><span class="nv">taskpool</span><span class="o">=</span>CLIPVisionModelTaskPool/clip-vit-classification_TA8_L14
</span></code></pre></div>
<h3 id="fisher-merging">Fisher Merging<a class="headerlink" href="#fisher-merging" title="Permanent link">&para;</a></h3>
<p>merge CLIP-ViT-B/32 models using Fisher Merging and evaluate on the eight tasks</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>fusion_bench<span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">  </span><span class="nv">method</span><span class="o">=</span>fisher_merging/clip_fisher_merging<span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">  </span><span class="nv">modelpool</span><span class="o">=</span>CLIPVisionModelPool/clip-vit-base-patch32_TA8<span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">  </span><span class="nv">taskpool</span><span class="o">=</span>CLIPVisionModelTaskPool/clip-vit-classification_TA8
</span></code></pre></div>
<p>merge CLIP-ViT-L/14 models using Fisher Merging and evaluate on the eight tasks</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>fusion_bench<span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="w">  </span><span class="nv">method</span><span class="o">=</span>fisher_merging/clip_fisher_merging<span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="w">    </span>method.dataloader_kwargs.batch_size<span class="o">=</span><span class="m">8</span><span class="w"> </span>method.dataloader_kwargs.num_workers<span class="o">=</span><span class="m">4</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="w">  </span><span class="nv">modelpool</span><span class="o">=</span>CLIPVisionModelPool/clip-vit-large-patch14_TA8<span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">  </span><span class="nv">taskpool</span><span class="o">=</span>CLIPVisionModelTaskPool/clip-vit-classification_TA8_L14
</span></code></pre></div>
<h3 id="regmean">RegMean<a class="headerlink" href="#regmean" title="Permanent link">&para;</a></h3>
<p>merge CLIP-ViT-B/32 models using RegMean and evaluate on the eight tasks</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>fusion_bench<span class="w"> </span><span class="nv">method</span><span class="o">=</span>regmean/clip_regmean<span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="w">  </span><span class="nv">modelpool</span><span class="o">=</span>CLIPVisionModelPool/clip-vit-base-patch32_TA8<span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="w">  </span><span class="nv">taskpool</span><span class="o">=</span>CLIPVisionModelTaskPool/clip-vit-classification_TA8
</span></code></pre></div>
<p>For CLIP-ViT-L/14 models:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>fusion_bench<span class="w"> </span><span class="se">\</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="w">  </span><span class="nv">method</span><span class="o">=</span>regmean/clip_regmean<span class="w"> </span><span class="se">\</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="w">    </span>method.dataloader_kwargs.batch_size<span class="o">=</span><span class="m">8</span><span class="w"> </span>method.dataloader_kwargs.num_workers<span class="o">=</span><span class="m">4</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w">  </span><span class="nv">modelpool</span><span class="o">=</span>CLIPVisionModelPool/clip-vit-large-patch14_TA8<span class="w"> </span><span class="se">\</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="w">  </span><span class="nv">taskpool</span><span class="o">=</span>CLIPVisionModelTaskPool/clip-vit-classification_TA8_L14
</span></code></pre></div>
<h3 id="task-arithmetic">Task Arithmetic<a class="headerlink" href="#task-arithmetic" title="Permanent link">&para;</a></h3>
<p>merge CLIP-ViT-B/32 models using task arithmetic and evaluate on the eight tasks</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>fusion_bench<span class="w"> </span><span class="nv">method</span><span class="o">=</span>task_arithmetic<span class="w"> </span>method.scaling_factor<span class="o">=</span><span class="m">0</span>.3<span class="se">\</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="w">  </span><span class="nv">modelpool</span><span class="o">=</span>CLIPVisionModelPool/clip-vit-base-patch32_TA8<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="w">  </span><span class="nv">taskpool</span><span class="o">=</span>CLIPVisionModelTaskPool/clip-vit-classification_TA8
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="c1"># results</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="o">{</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="w">    </span><span class="s2">&quot;svhn&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;accuracy&quot;</span>:<span class="w"> </span><span class="m">0</span>.77927166223526,<span class="w"> </span><span class="s2">&quot;loss&quot;</span>:<span class="w"> </span><span class="m">0</span>.7050645351409912<span class="o">}</span>,
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="w">    </span><span class="s2">&quot;stanford_cars&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;accuracy&quot;</span>:<span class="w"> </span><span class="m">0</span>.5565228462219238,<span class="w"> </span><span class="s2">&quot;loss&quot;</span>:<span class="w"> </span><span class="m">1</span>.4873239994049072<span class="o">}</span>,
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="w">    </span><span class="s2">&quot;resisc45&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;accuracy&quot;</span>:<span class="w"> </span><span class="m">0</span>.6487301588058472,<span class="w"> </span><span class="s2">&quot;loss&quot;</span>:<span class="w"> </span><span class="m">1</span>.3709946870803833<span class="o">}</span>,
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="w">    </span><span class="s2">&quot;eurosat&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;accuracy&quot;</span>:<span class="w"> </span><span class="m">0</span>.7674074172973633,<span class="w"> </span><span class="s2">&quot;loss&quot;</span>:<span class="w"> </span><span class="m">0</span>.6550557017326355<span class="o">}</span>,
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="w">    </span><span class="s2">&quot;gtsrb&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;accuracy&quot;</span>:<span class="w"> </span><span class="m">0</span>.6850356459617615,<span class="w"> </span><span class="s2">&quot;loss&quot;</span>:<span class="w"> </span><span class="m">1</span>.2349143028259277<span class="o">}</span>,
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="w">    </span><span class="s2">&quot;mnist&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;accuracy&quot;</span>:<span class="w"> </span><span class="m">0</span>.9606999754905701,<span class="w"> </span><span class="s2">&quot;loss&quot;</span>:<span class="w"> </span><span class="m">0</span>.1570172756910324<span class="o">}</span>,
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="w">    </span><span class="s2">&quot;dtd&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;accuracy&quot;</span>:<span class="w"> </span><span class="m">0</span>.471808522939682,<span class="w"> </span><span class="s2">&quot;loss&quot;</span>:<span class="w"> </span><span class="m">2</span>.1495635509490967<span class="o">}</span>,
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a><span class="w">    </span><span class="s2">&quot;sun397&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;accuracy&quot;</span>:<span class="w"> </span><span class="m">0</span>.571083128452301,<span class="w"> </span><span class="s2">&quot;loss&quot;</span>:<span class="w"> </span><span class="m">1</span>.7016042470932007<span class="o">}</span>,
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a><span class="o">}</span>
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1"># or use a for loop to try different scaling factors </span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="c1"># and save the results to different files</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="k">for</span><span class="w"> </span>scaling_factor<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0</span>.1<span class="w"> </span><span class="m">0</span>.2<span class="w"> </span><span class="m">0</span>.3<span class="w"> </span><span class="m">0</span>.4<span class="w"> </span><span class="m">0</span>.5<span class="w"> </span><span class="m">0</span>.6<span class="w"> </span><span class="m">0</span>.7<span class="w"> </span><span class="m">0</span>.8<span class="w"> </span><span class="m">0</span>.9<span class="w"> </span><span class="m">1</span>.0
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="k">do</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="w">  </span>fusion_bench<span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="w">    </span><span class="nv">method</span><span class="o">=</span>task_arithmetic<span class="w"> </span>method.scaling_factor<span class="o">=</span><span class="nv">$scaling_factor</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="w">    </span><span class="nv">modelpool</span><span class="o">=</span>CLIPVisionModelPool/clip-vit-base-patch32_TA8<span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="w">    </span><span class="nv">taskpool</span><span class="o">=</span>CLIPVisionModelTaskPool/clip-vit-classification_TA8<span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="w">    </span><span class="nv">report_save_path</span><span class="o">=</span>outputs/clip-vit-base-patch32_TA8_task_arithmetic_scaling_factor_<span class="si">${</span><span class="nv">scaling_factor</span><span class="si">}</span>.json
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="k">done</span>
</span></code></pre></div>
<p>merge CLIP-ViT-L/14 models using task arithmetic and evaluate on the eight tasks</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>fusion_bench<span class="w"> </span><span class="nv">method</span><span class="o">=</span>task_arithmetic<span class="w"> </span>method.scaling_factor<span class="o">=</span><span class="m">0</span>.3<span class="se">\</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="w">  </span><span class="nv">modelpool</span><span class="o">=</span>CLIPVisionModelPool/clip-vit-large-patch14_TA8<span class="w"> </span><span class="se">\</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="w">  </span><span class="nv">taskpool</span><span class="o">=</span>CLIPVisionModelTaskPool/clip-vit-classification_TA8_L14
</span></code></pre></div>
<h3 id="ties-merging">Ties-Merging<a class="headerlink" href="#ties-merging" title="Permanent link">&para;</a></h3>
<p>merge CLIP-ViT-B/32 models using Ties-Merging and evaluate on the eight tasks</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>fusion_bench<span class="w"> </span><span class="nv">method</span><span class="o">=</span>ties_merging<span class="w"> </span>method.scaling_factor<span class="o">=</span><span class="m">0</span>.3<span class="w"> </span>method.threshold<span class="o">=</span><span class="m">20</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="w">  </span><span class="nv">modelpool</span><span class="o">=</span>CLIPVisionModelPool/clip-vit-base-patch32_TA8<span class="w"> </span><span class="se">\</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="w">  </span><span class="nv">taskpool</span><span class="o">=</span>CLIPVisionModelTaskPool/clip-vit-classification_TA8
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="c1"># or use a for loop to try different scaling factors</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="c1"># and save the results to different files</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="k">for</span><span class="w"> </span>scaling_factor<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0</span>.1<span class="w"> </span><span class="m">0</span>.2<span class="w"> </span><span class="m">0</span>.3<span class="w"> </span><span class="m">0</span>.4<span class="w"> </span><span class="m">0</span>.5<span class="w"> </span><span class="m">0</span>.6<span class="w"> </span><span class="m">0</span>.7<span class="w"> </span><span class="m">0</span>.8<span class="w"> </span><span class="m">0</span>.9<span class="w"> </span><span class="m">1</span>.0
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="k">do</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="w">  </span>fusion_bench<span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="w">    </span><span class="nv">method</span><span class="o">=</span>ties_merging<span class="w"> </span>method.scaling_factor<span class="o">=</span><span class="nv">$scaling_factor</span><span class="w"> </span>method.threshold<span class="o">=</span><span class="m">20</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="w">    </span><span class="nv">modelpool</span><span class="o">=</span>CLIPVisionModelPool/clip-vit-base-patch32_TA8<span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="w">    </span><span class="nv">taskpool</span><span class="o">=</span>CLIPVisionModelTaskPool/clip-vit-classification_TA8<span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="w">    </span><span class="nv">report_save_path</span><span class="o">=</span>outputs/clip-vit-base-patch32_TA8_ties_merging_scaling_factor_<span class="si">${</span><span class="nv">scaling_factor</span><span class="si">}</span>.json
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="k">done</span>
</span></code></pre></div>
<p>merge CLIP-ViT-L/14 models using Ties-Merging and evaluate on the eight tasks</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>fusion_bench<span class="w"> </span><span class="nv">method</span><span class="o">=</span>ties_merging<span class="w"> </span>method.scaling_factor<span class="o">=</span><span class="m">0</span>.3<span class="w"> </span>method.threshold<span class="o">=</span><span class="m">20</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="w">  </span><span class="nv">modelpool</span><span class="o">=</span>CLIPVisionModelPool/clip-vit-large-patch14_TA8<span class="w"> </span><span class="se">\</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="w">  </span><span class="nv">taskpool</span><span class="o">=</span>CLIPVisionModelTaskPool/clip-vit-classification_TA8_L14
</span></code></pre></div>
<h3 id="adamerging"><a href="../../algorithms/adamerging/">AdaMerging</a><a class="headerlink" href="#adamerging" title="Permanent link">&para;</a></h3>
<p>merge CLIP-ViT-B/32 models using task-wise AdaMerging and evaluate on the eight tasks, and save the merging weights by specifying the <code>method.save_merging_weights</code> parameter</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>fusion_bench<span class="w"> </span><span class="se">\</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="w">  </span><span class="nv">method</span><span class="o">=</span>adamerging<span class="w"> </span><span class="se">\</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="w">    </span>method.name<span class="o">=</span>clip_task_wise_adamerging<span class="w"> </span><span class="se">\</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="w">    </span>method.save_merging_weights<span class="o">=</span>outputs/clip-vit-base-patch32_TA8_task_wise_adamerging_weights.pt<span class="w"> </span><span class="se">\</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="w">  </span><span class="nv">modelpool</span><span class="o">=</span>CLIPVisionModelPool/clip-vit-base-patch32_TA8<span class="w"> </span><span class="se">\</span>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="w">  </span><span class="nv">taskpool</span><span class="o">=</span>CLIPVisionModelTaskPool/clip-vit-classification_TA8
</span></code></pre></div>
<p>merge CLIP-ViT-L/14 models using task-wise AdaMerging and evaluate on the eight tasks, and save the merging weights by specifying the <code>method.save_merging_weights</code> parameter.
Here we split the training process into two stages, the first stage is to train the merging weights, and the second stage is to evaluate the model with the learned merging weights.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="c1"># learn the merging weights.</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="c1"># the per-device batch size is 4, and the total batch size is 4*4=16</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>fusion_bench<span class="w"> </span><span class="nv">print_config</span><span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="w">  </span><span class="nv">method</span><span class="o">=</span>adamerging<span class="w"> </span><span class="se">\</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="w">    </span>method.name<span class="o">=</span>clip_task_wise_adamerging<span class="w"> </span><span class="se">\</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="w">    </span>method.save_merging_weights<span class="o">=</span>outputs/clip-vit-large-patch14_TA8_task_wise_adamerging_weights.pt<span class="w"> </span><span class="se">\</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="w">    </span>method.devices<span class="o">=</span><span class="m">4</span><span class="w"> </span>method.batch_size<span class="o">=</span><span class="m">4</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a><span class="w">  </span><span class="nv">modelpool</span><span class="o">=</span>CLIPVisionModelPool/clip-vit-large-patch14_TA8<span class="w"> </span><span class="se">\</span>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a><span class="w">  </span><span class="nv">taskpool</span><span class="o">=</span>dummy<span class="w"> </span><span class="c1"># dummy taskpool is used to skip the evaluation process</span>
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a>
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a><span class="c1"># by specifying the learned merging weights, we skip the training process and directly evaluate the model</span>
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a>fusion_bench<span class="w"> </span><span class="nv">print_config</span><span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a><span class="w">  </span><span class="nv">method</span><span class="o">=</span>adamerging<span class="w"> </span><span class="se">\</span>
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a><span class="w">    </span>method.name<span class="o">=</span>clip_task_wise_adamerging<span class="w"> </span><span class="se">\</span>
</span><span id="__span-27-15"><a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a><span class="w">    </span>method.weights<span class="o">=</span>outputs/clip-vit-large-patch14_TA8_task_wise_adamerging_weights.pt<span class="w"> </span><span class="se">\</span>
</span><span id="__span-27-16"><a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a><span class="w">  </span><span class="nv">modelpool</span><span class="o">=</span>CLIPVisionModelPool/clip-vit-large-patch14_TA8<span class="w"> </span><span class="se">\</span>
</span><span id="__span-27-17"><a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a><span class="w">  </span><span class="nv">taskpool</span><span class="o">=</span>CLIPVisionModelTaskPool/clip-vit-classification_TA8_L14
</span></code></pre></div>
<p>merge CLIP-ViT-B/32 models using layer-wise AdaMerging and evaluate on the eight tasks</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>fusion_bench<span class="w"> </span><span class="se">\</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="w">    </span><span class="nv">method</span><span class="o">=</span>adamerging<span class="w"> </span><span class="se">\</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="w">        </span>method.name<span class="o">=</span>clip_layer_wise_adamerging<span class="w"> </span><span class="se">\</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="w">        </span>method.save_merging_weights<span class="o">=</span>merging_weights.pt<span class="w"> </span><span class="se">\</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="w">    </span><span class="nv">modelpool</span><span class="o">=</span>CLIPVisionModelPool/clip-vit-base-patch32_TA8<span class="w"> </span><span class="se">\</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="w">    </span><span class="nv">taskpool</span><span class="o">=</span>CLIPVisionModelTaskPool/clip-vit-classification_TA8<span class="w"> </span><span class="se">\</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="w">    </span>fabric.loggers.root_dir<span class="o">=</span>outputs/logs/ViT-B-32<span class="w"> </span><span class="se">\</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="w">    </span>fabric.loggers.name<span class="o">=</span>clip_layer_wise_adamerging_adam
</span></code></pre></div>
<p>merge CLIP-ViT-L/14 models using layer-wise AdaMerging and evaluate on the eight tasks</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="c1"># learn the merging weights.</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="c1"># the per-device batch size is 4, and the total batch size is 4*4=16</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>fusion_bench<span class="w"> </span><span class="nv">print_config</span><span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="w">  </span><span class="nv">method</span><span class="o">=</span>adamerging<span class="w"> </span><span class="se">\</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="w">    </span>method.name<span class="o">=</span>clip_layer_wise_adamerging<span class="w"> </span><span class="se">\</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="w">    </span>method.save_merging_weights<span class="o">=</span>outputs/clip-vit-large-patch14_TA8_layer_wise_adamerging_weights.pt<span class="w"> </span><span class="se">\</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="w">    </span>method.devices<span class="o">=</span><span class="m">4</span><span class="w"> </span>method.batch_size<span class="o">=</span><span class="m">4</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="w">  </span><span class="nv">modelpool</span><span class="o">=</span>CLIPVisionModelPool/clip-vit-large-patch14_TA8<span class="w"> </span><span class="se">\</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="w">  </span><span class="nv">taskpool</span><span class="o">=</span>dummy<span class="w"> </span><span class="c1"># dummy taskpool is used to skip the evaluation process</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a><span class="c1"># by specifying the learned merging weights, we skip the training process and directly evaluate the model</span>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a>fusion_bench<span class="w"> </span><span class="se">\</span>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a><span class="w">  </span><span class="nv">method</span><span class="o">=</span>adamerging<span class="w"> </span><span class="se">\</span>
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a><span class="w">    </span>method.name<span class="o">=</span>clip_layer_wise_adamerging<span class="w"> </span><span class="se">\</span>
</span><span id="__span-29-15"><a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a><span class="w">    </span>method.weights<span class="o">=</span>outputs/clip-vit-large-patch14_TA8_layer_wise_adamerging_weights.pt<span class="w"> </span><span class="se">\</span>
</span><span id="__span-29-16"><a id="__codelineno-29-16" name="__codelineno-29-16" href="#__codelineno-29-16"></a><span class="w">  </span><span class="nv">modelpool</span><span class="o">=</span>CLIPVisionModelPool/clip-vit-large-patch14_TA8<span class="w"> </span><span class="se">\</span>
</span><span id="__span-29-17"><a id="__codelineno-29-17" name="__codelineno-29-17" href="#__codelineno-29-17"></a><span class="w">  </span><span class="nv">taskpool</span><span class="o">=</span>CLIPVisionModelTaskPool/clip-vit-classification_TA8_L14
</span></code></pre></div>
<h3 id="weight-ensembling-moe">Weight-Ensembling MoE<a class="headerlink" href="#weight-ensembling-moe" title="Permanent link">&para;</a></h3>
<p>fuse CLIP-ViT-B/32 models using Weight-Ensembling Mixture of Experts and evaluate on the eight tasks</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>fusion_bench<span class="w"> </span><span class="se">\</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="w">  </span><span class="nv">method</span><span class="o">=</span>weight_ensembling_moe<span class="w"> </span><span class="se">\</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="w">    </span>method.name<span class="o">=</span>clip_weight_ensembling_moe<span class="w"> </span><span class="se">\</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="w">    </span>method.use_grad_accumulate<span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="w">    </span>method.save_checkpoint<span class="o">=</span>outputs/clip-vit-base-patch32_TA8_weight_ensembling_moe_checkpoint.ckpt<span class="w"> </span><span class="se">\</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="w">  </span><span class="nv">modelpool</span><span class="o">=</span>CLIPVisionModelPool/clip-vit-base-patch32_TA8<span class="w"> </span><span class="se">\</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a><span class="w">  </span><span class="nv">taskpool</span><span class="o">=</span>CLIPVisionModelTaskPool/clip-vit-classification_TA8
</span></code></pre></div>
<p>fuse CLIP-ViT-L/14 models using Weight-Ensembling Mixture of Experts and evaluate on the eight tasks</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="c1"># merge eight CLIP-ViT-L/14 models using WE MoE, fine-tune the routers</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>fusion_bench<span class="w"> </span><span class="nv">print_config</span><span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="w">  </span><span class="nv">method</span><span class="o">=</span>weight_ensembling_moe<span class="w"> </span><span class="se">\</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="w">    </span>method.name<span class="o">=</span>clip_weight_ensembling_moe<span class="w"> </span><span class="se">\</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="w">    </span>method.use_grad_accumulate<span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="w">    </span>method.save_checkpoint<span class="o">=</span>outputs/clip-vit-large-patch14_TA8_weight_ensembling_moe_checkpoint.ckpt<span class="w"> </span><span class="se">\</span>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="w">    </span>method.batch_size<span class="o">=</span><span class="m">4</span><span class="w"> </span>method.devices<span class="o">=</span><span class="m">4</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="w">  </span><span class="nv">modelpool</span><span class="o">=</span>CLIPVisionModelPool/clip-vit-large-patch14_TA8<span class="w"> </span><span class="se">\</span>
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="w">  </span><span class="nv">taskpool</span><span class="o">=</span>dummy<span class="w"> </span><span class="o">&amp;&amp;</span>
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a>
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a><span class="c1"># load the checkpoint and evaluate the model</span>
</span><span id="__span-31-12"><a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a>fusion_bench<span class="w"> </span><span class="se">\</span>
</span><span id="__span-31-13"><a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a><span class="w">  </span><span class="nv">method</span><span class="o">=</span>weight_ensembling_moe<span class="w"> </span><span class="se">\</span>
</span><span id="__span-31-14"><a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a><span class="w">    </span>method.name<span class="o">=</span>clip_weight_ensembling_moe<span class="w"> </span><span class="se">\</span>
</span><span id="__span-31-15"><a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a><span class="w">    </span>method.checkpoint<span class="o">=</span>outputs/clip-vit-large-patch14_TA8_weight_ensembling_moe_checkpoint.ckpt<span class="w"> </span><span class="se">\</span>
</span><span id="__span-31-16"><a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a><span class="w">  </span><span class="nv">modelpool</span><span class="o">=</span>CLIPVisionModelPool/clip-vit-large-patch14_TA8<span class="w"> </span><span class="se">\</span>
</span><span id="__span-31-17"><a id="__codelineno-31-17" name="__codelineno-31-17" href="#__codelineno-31-17"></a><span class="w">  </span><span class="nv">taskpool</span><span class="o">=</span>CLIPVisionModelTaskPool/clip-vit-classification_TA8_L14
</span></code></pre></div>
<h3 id="experimental-results">Experimental Results<a class="headerlink" href="#experimental-results" title="Permanent link">&para;</a></h3>
<p>We provide the experimental results of the CLIP-ViT models for open vocabulary image classification on the eight tasks in the following table.</p>
<div class="admonition info">
<p class="admonition-title">Hyperparameters not fully optimized</p>
<p>The hyperparameters used in these merging methods are not fully optimized and should be considered as preliminary results only. We welcome any discoveries of more effective parameters and would be grateful for your contributions to help us improve our results.</p>
<p>Please note that some model merging paper results were obtained using <a href="https://github.com/mlfoundations/task_vectors">OpenCLIP models</a>, which may show discrepancies with the results presented here. In such cases, the results reported in the original papers should be considered authoritative.</p>
</div>
<div class="tabbed-set tabbed-alternate" data-tabs="3:3"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><input id="__tabbed_3_3" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">Table: Multi-task model merging methods using CLIP-ViT-B/32 models.</label><label for="__tabbed_3_2">Table: Multi-task model merging methods using CLIP-ViT-B/16 models.</label><label for="__tabbed_3_3">Table: Multi-task model merging methods using CLIP-ViT-L/14 models.</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Method</th>
<th>SUN397</th>
<th>Cars</th>
<th>RESISC45</th>
<th>EuroSAT</th>
<th>SVHN</th>
<th>GTSRB</th>
<th>MNIST</th>
<th>DTD</th>
<th>Average</th>
</tr>
</thead>
<tbody>
<tr>
<td>Reference Results</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Pre-trained</td>
<td>63.2</td>
<td>59.8</td>
<td>60.7</td>
<td>46.0</td>
<td>31.6</td>
<td>32.5</td>
<td>48.2</td>
<td>43.9</td>
<td>48.2</td>
</tr>
<tr>
<td>Fine-tuned (STL)</td>
<td>75.0</td>
<td>78.3</td>
<td>95.2</td>
<td>99.0</td>
<td>97.3</td>
<td>98.9</td>
<td>99.6</td>
<td>79.7</td>
<td>90.3</td>
</tr>
<tr>
<td>Traditional MTL</td>
<td>72.3</td>
<td>76.6</td>
<td>92.2</td>
<td>97.9</td>
<td>95.5</td>
<td>97.7</td>
<td>99.3</td>
<td>77.7</td>
<td>88.6</td>
</tr>
<tr>
<td>Model Merging</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Simple Averaging</td>
<td>65.4</td>
<td>62.6</td>
<td>70.8</td>
<td>76.9</td>
<td>64.5</td>
<td>54.9</td>
<td>86.3</td>
<td>50.9</td>
<td>66.5</td>
</tr>
<tr>
<td>Fisher Merging</td>
<td>66.7</td>
<td>64.0</td>
<td>72.2</td>
<td>91.6</td>
<td>69.0</td>
<td>64.3</td>
<td>83.5</td>
<td>53.7</td>
<td>70.6</td>
</tr>
<tr>
<td>RegMean</td>
<td>67.8</td>
<td>68.9</td>
<td>82.5</td>
<td>94.4</td>
<td>90.6</td>
<td>79.2</td>
<td>97.6</td>
<td>63.2</td>
<td>80.5</td>
</tr>
<tr>
<td>Task Arithmetic (<span class="arithmatex">\(\lambda=0.3\)</span>)</td>
<td>57.1</td>
<td>55.7</td>
<td>64.9</td>
<td>76.7</td>
<td>77.9</td>
<td>68.5</td>
<td>96.1</td>
<td>47.2</td>
<td>68.0</td>
</tr>
<tr>
<td>Concrete Task Arithmetic (<span class="arithmatex">\(\lambda=0.3\)</span>)</td>
<td>64.2</td>
<td>63.3</td>
<td>75.6</td>
<td>94.1</td>
<td>90.3</td>
<td>82.9</td>
<td>98.0</td>
<td>52.5</td>
<td>77.6</td>
</tr>
<tr>
<td>Ties-Merging (<span class="arithmatex">\(\lambda=0.3\)</span>)</td>
<td>67.1</td>
<td>64.2</td>
<td>74.1</td>
<td>76.8</td>
<td>77.7</td>
<td>69.4</td>
<td>94.1</td>
<td>54.0</td>
<td>72.2</td>
</tr>
<tr>
<td>Task-wise AdaMerging (<span class="arithmatex">\(\lambda=0.3\)</span>)</td>
<td>58.6</td>
<td>56.9</td>
<td>69.8</td>
<td>82.4</td>
<td>70.3</td>
<td>58.9</td>
<td>97.2</td>
<td>55.3</td>
<td>68.7</td>
</tr>
<tr>
<td>Layer-wise AdaMerging (<span class="arithmatex">\(\lambda=0.3\)</span>)</td>
<td>67.9</td>
<td>71.3</td>
<td>83.5</td>
<td>92.7</td>
<td>87.4</td>
<td>92.9</td>
<td>98.2</td>
<td>67.0</td>
<td>82.6</td>
</tr>
<tr>
<td>Concrete Layer-wise AdaMerging (<span class="arithmatex">\(\lambda=0.3\)</span>)</td>
<td>69.1</td>
<td>72.7</td>
<td>85.9</td>
<td>94.7</td>
<td>91.3</td>
<td>95.7</td>
<td>98.7</td>
<td>66.8</td>
<td>84.4</td>
</tr>
<tr>
<td>Model Mixing</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Efficient Weight-Ensembling MoE (<span class="arithmatex">\(90\%\)</span>)</td>
<td>74.3</td>
<td>76.3</td>
<td>92.7</td>
<td>97.9</td>
<td>96.1</td>
<td>98.6</td>
<td>99.5</td>
<td>77.8</td>
<td>89.1</td>
</tr>
<tr>
<td>Weight-Ensembling MoE</td>
<td>73.7</td>
<td>76.8</td>
<td>93.4</td>
<td>98.2</td>
<td>96.8</td>
<td>98.2</td>
<td>99.6</td>
<td>76.6</td>
<td>89.2</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Method</th>
<th>SUN397</th>
<th>Cars</th>
<th>RESISC45</th>
<th>EuroSAT</th>
<th>SVHN</th>
<th>GTSRB</th>
<th>MNIST</th>
<th>DTD</th>
<th>Average</th>
</tr>
</thead>
<tbody>
<tr>
<td>Reference Results</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Pre-trained</td>
<td>65.5</td>
<td>64.6</td>
<td>66.3</td>
<td>54.1</td>
<td>51.9</td>
<td>43.4</td>
<td>51.7</td>
<td>44.9</td>
<td>55.3</td>
</tr>
<tr>
<td>Fine-tuned (STL)</td>
<td>78.9</td>
<td>85.9</td>
<td>96.6</td>
<td>99.0</td>
<td>97.6</td>
<td>99.0</td>
<td>99.7</td>
<td>82.3</td>
<td>92.3</td>
</tr>
<tr>
<td>Model Merging</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Simple Averaging</td>
<td>68.7</td>
<td>69.0</td>
<td>75.0</td>
<td>83.2</td>
<td>74.9</td>
<td>62.5</td>
<td>93.7</td>
<td>51.1</td>
<td>72.3</td>
</tr>
<tr>
<td>Fisher Merging</td>
<td>70.8</td>
<td>71.8</td>
<td>76.2</td>
<td>93.4</td>
<td>77.4</td>
<td>61.2</td>
<td>90.7</td>
<td>52.3</td>
<td>74.2</td>
</tr>
<tr>
<td>RegMean</td>
<td>71.1</td>
<td>76.4</td>
<td>86.0</td>
<td>95.4</td>
<td>93.9</td>
<td>86.5</td>
<td>98.4</td>
<td>64.3</td>
<td>84.0</td>
</tr>
<tr>
<td>Task Arithmetic (<span class="arithmatex">\(\lambda=0.3\)</span>)</td>
<td>65.9</td>
<td>68.3</td>
<td>75.4</td>
<td>84.5</td>
<td>88.8</td>
<td>81.9</td>
<td>98.0</td>
<td>53.9</td>
<td>77.1</td>
</tr>
<tr>
<td>Ties-Merging (<span class="arithmatex">\(\lambda=0.3\)</span>)</td>
<td>70.6</td>
<td>71.2</td>
<td>79.8</td>
<td>87.5</td>
<td>83.2</td>
<td>76.2</td>
<td>96.4</td>
<td>55.4</td>
<td>77.5</td>
</tr>
<tr>
<td>Layer-wise AdaMerging (<span class="arithmatex">\(\lambda=0.3\)</span>)</td>
<td>70.6</td>
<td>79.6</td>
<td>86.1</td>
<td>93.6</td>
<td>93.5</td>
<td>95.4</td>
<td>98.1</td>
<td>62.9</td>
<td>85.0</td>
</tr>
<tr>
<td>Model Mixing</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Efficient Weight-Ensembling MoE (<span class="arithmatex">\(90\%\)</span>)</td>
<td>77.7</td>
<td>85.0</td>
<td>94.9</td>
<td>98.2</td>
<td>97.2</td>
<td>98.9</td>
<td>99.5</td>
<td>81.4</td>
<td>91.6</td>
</tr>
<tr>
<td>Weight-Ensembling MoE</td>
<td>77.2</td>
<td>85.0</td>
<td>94.8</td>
<td>98.3</td>
<td>97.3</td>
<td>98.9</td>
<td>99.6</td>
<td>80.8</td>
<td>91.5</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Method</th>
<th>SUN397</th>
<th>Cars</th>
<th>RESISC45</th>
<th>EuroSAT</th>
<th>SVHN</th>
<th>GTSRB</th>
<th>MNIST</th>
<th>DTD</th>
<th>Average</th>
</tr>
</thead>
<tbody>
<tr>
<td>Reference Results</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Pre-trained</td>
<td>68.3</td>
<td>77.8</td>
<td>71.0</td>
<td>58.9</td>
<td>58.4</td>
<td>50.6</td>
<td>76.4</td>
<td>55.5</td>
<td>64.6</td>
</tr>
<tr>
<td>Fine-tuned (STL)</td>
<td>82.8</td>
<td>92.9</td>
<td>97.4</td>
<td>99.2</td>
<td>97.9</td>
<td>99.2</td>
<td>99.8</td>
<td>85.5</td>
<td>94.3</td>
</tr>
<tr>
<td>Traditional MTL</td>
<td>79.0</td>
<td>89.3</td>
<td>94.5</td>
<td>98.4</td>
<td>96.4</td>
<td>98.1</td>
<td>99.4</td>
<td>83.7</td>
<td>92.4</td>
</tr>
<tr>
<td>Model Merging</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Simple Averaging</td>
<td>72.5</td>
<td>81.5</td>
<td>82.2</td>
<td>90.0</td>
<td>81.6</td>
<td>74.0</td>
<td>96.6</td>
<td>61.8</td>
<td>80.0</td>
</tr>
<tr>
<td>Fisher Merging</td>
<td>70.6</td>
<td>79.4</td>
<td>84.1</td>
<td>98.1</td>
<td>74.7</td>
<td>85.0</td>
<td>89.5</td>
<td>61.0</td>
<td>80.3</td>
</tr>
<tr>
<td>RegMean</td>
<td>75.3</td>
<td>88.4</td>
<td>90.0</td>
<td>97.1</td>
<td>95.9</td>
<td>92.4</td>
<td>98.5</td>
<td>72.6</td>
<td>88.8</td>
</tr>
<tr>
<td>Task Arithmetic (<span class="arithmatex">\(\lambda=0.3\)</span>)</td>
<td>72.0</td>
<td>79.0</td>
<td>80.5</td>
<td>86.0</td>
<td>87.5</td>
<td>83.5</td>
<td>98.0</td>
<td>58.8</td>
<td>80.7</td>
</tr>
<tr>
<td>Ties-Merging (<span class="arithmatex">\(\lambda=0.3\)</span>)</td>
<td>74.7</td>
<td>83.3</td>
<td>86.4</td>
<td>91.3</td>
<td>89.7</td>
<td>85.2</td>
<td>97.8</td>
<td>63.9</td>
<td>84.0</td>
</tr>
<tr>
<td>Task-wise AdaMerging (<span class="arithmatex">\(\lambda=0.3\)</span>)</td>
<td>75.8</td>
<td>80.1</td>
<td>77.2</td>
<td>83.6</td>
<td>68.4</td>
<td>93.5</td>
<td>93.1</td>
<td>69.0</td>
<td>80.1</td>
</tr>
<tr>
<td>Layer-wise AdaMerging (<span class="arithmatex">\(\lambda=0.3\)</span>)</td>
<td>78.1</td>
<td>90.7</td>
<td>90.8</td>
<td>96.5</td>
<td>94.8</td>
<td>97.5</td>
<td>98.6</td>
<td>81.3</td>
<td>91.0</td>
</tr>
<tr>
<td>Model Mixing</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Efficient Weight-Ensembling MoE (<span class="arithmatex">\(90\%\)</span>)</td>
<td>81.5</td>
<td>92.0</td>
<td>96.0</td>
<td>97.8</td>
<td>97.7</td>
<td>99.1</td>
<td>99.5</td>
<td>84.1</td>
<td>93.5</td>
</tr>
<tr>
<td>Weight-Ensembling MoE</td>
<td>81.5</td>
<td>92.3</td>
<td>96.5</td>
<td>98.8</td>
<td>97.6</td>
<td>99.4</td>
<td>99.6</td>
<td>84.5</td>
<td>93.8</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<h2 id="scope">Scope<a class="headerlink" href="#scope" title="Permanent link">&para;</a></h2>
<h3 id="task-vector-cosine-similarity">Task Vector Cosine Similarity<a class="headerlink" href="#task-vector-cosine-similarity" title="Permanent link">&para;</a></h3>
<p>Compute the cosine similarities between the task vectors and save the results to a CSV file.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="c1"># CLIP-ViT-B/32 models</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>fusion_bench<span class="w"> </span><span class="se">\</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="w">  </span><span class="nv">method</span><span class="o">=</span>task_vector_cos_similarity<span class="w"> </span><span class="se">\</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="w">    </span>method.save_to_csv<span class="o">=</span><span class="s1">&#39;outputs/clip-vit-base-patch32_cos.csv&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="w">  </span><span class="nv">modelpool</span><span class="o">=</span>CLIPVisionModelPool/clip-vit-base-patch32_TA8<span class="w"> </span><span class="se">\</span>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="w">  </span><span class="nv">taskpool</span><span class="o">=</span>dummy<span class="w">  </span><span class="c1"># do not evaluate the model</span>
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a>
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a><span class="c1"># CLIP-ViT-L/14 models</span>
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a>fusion_bench<span class="w"> </span><span class="se">\</span>
</span><span id="__span-32-10"><a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a><span class="w">  </span><span class="nv">method</span><span class="o">=</span>task_vector_cos_similarity<span class="w"> </span><span class="se">\</span>
</span><span id="__span-32-11"><a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a><span class="w">    </span>method.save_to_csv<span class="o">=</span><span class="s1">&#39;outputs/clip-vit-large-patch14_cos.csv&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-32-12"><a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a><span class="w">  </span><span class="nv">modelpool</span><span class="o">=</span>CLIPVisionModelPool/clip-vit-base-patch32_TA8<span class="w"> </span><span class="se">\</span>
</span><span id="__span-32-13"><a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a><span class="w">  </span><span class="nv">tsakpool</span><span class="o">=</span>dummy
</span></code></pre></div>
<figure>
  <img alt="alt text" src="../clip-vit-cos.png" />
  <figcaption>Cosine similarity matrices of task vectors for CLIP-ViT-B/32 and CLIP-ViT-L/14 models.</figcaption>
</figure>
<h3 id="generalization-and-robustness-evaluation">Generalization and Robustness Evaluation<a class="headerlink" href="#generalization-and-robustness-evaluation" title="Permanent link">&para;</a></h3>
<p>You can also evaluate the generalization and robustness of different multi-task model fusion methods by change the configurations.</p>
<p>Instruction for running the generalization experiments:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>fusion_bench<span class="w"> </span><span class="se">\</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="w">    </span><span class="nv">method</span><span class="o">=</span>...<span class="w"> </span><span class="se">\</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="w">    </span><span class="nv">modelpool</span><span class="o">=</span>CLIPVisionModelPool/clip-vit-base-patch32_generalization_exp1<span class="w"> </span><span class="c1"># or `clip-vit-base-patch32_generalization_exp2`</span>
</span></code></pre></div>
<p>Instruction for running the robustness experiments:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="c1"># corription can be one of the following values: </span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="c1"># contrast, gaussian_noise, impulse_noise, jpeg_compression, motion_blur, pixelate, spatter</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="c1"># or pass `taskpool=clip-vit-base-patch32_robustness_clean` to evaluate the model on clean data</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="nv">corruption</span><span class="o">=</span>contrast
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>fusion_bench<span class="w"> </span><span class="se">\</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="w">    </span>--config-name<span class="w"> </span>clip-vit-base-patch32_robustness_corrupted<span class="w"> </span><span class="se">\</span>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="w">    </span><span class="nv">corruption</span><span class="o">=</span><span class="si">${</span><span class="nv">corruption</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="w">    </span><span class="nv">method</span><span class="o">=</span>...<span class="w"> </span><span class="se">\</span>
</span></code></pre></div>
<p>Below is an example of different types of corruptions:</p>
<figure>
<img alt="alt text" src="../images/clip_eight_corruption.png" width="800px" />
<figcaption style="max-width:90%">
An example of corruption data visualization, in which the corruption image generation method refers to Hendrycks &amp; Dietterich (2019) <sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup>.
</figcaption>
</figure>
<h3 id="experimental-results_1">Experimental Results<a class="headerlink" href="#experimental-results_1" title="Permanent link">&para;</a></h3>
<div class="admonition info">
<p class="admonition-title">Hyperparameters not fully optimized</p>
<p>The hyperparameters used in these merging methods are not fully optimized and should be considered as preliminary results only. We welcome any discoveries of more effective parameters and would be grateful for your contributions to help us improve our results.</p>
<p>Please note that some model merging paper results were obtained using <a href="https://github.com/mlfoundations/task_vectors">OpenCLIP models</a>, which may show discrepancies with the results presented here. In such cases, the results reported in the original papers should be considered authoritative.</p>
</div>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">Table: Results of the generalization experiments (Exp1).</label><label for="__tabbed_4_2">Table: Results of the generalization experiments (Exp2).</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th></th>
<th>Seen Tasks</th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th>Unseen Tasks</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Method</td>
<td>SUN397</td>
<td>Cars</td>
<td>RESISC45</td>
<td>DTD</td>
<td>SVHN</td>
<td>GTSRB</td>
<td>Avg.</td>
<td>MNIST</td>
<td>EuroSAT</td>
<td>Avg.</td>
</tr>
<tr>
<td>Pre-trained</td>
<td>63.2</td>
<td>59.9</td>
<td>60.6</td>
<td>43.9</td>
<td>23.5</td>
<td>30.4</td>
<td>46.9</td>
<td>47.6</td>
<td>45.6</td>
<td>46.6</td>
</tr>
<tr>
<td>Fisher Merging</td>
<td>65.5</td>
<td>67.2</td>
<td>78.2</td>
<td>57.6</td>
<td>84.2</td>
<td>75.9</td>
<td>71.4</td>
<td>71.8</td>
<td>49.4</td>
<td>60.6</td>
</tr>
<tr>
<td>RegMean</td>
<td>68.7</td>
<td>70.0</td>
<td>86.5</td>
<td>65.9</td>
<td>93.9</td>
<td>86.7</td>
<td>78.6</td>
<td>82.2</td>
<td>49.3</td>
<td>65.7</td>
</tr>
<tr>
<td>Task Arithmetic</td>
<td>64.3</td>
<td>63.0</td>
<td>73.2</td>
<td>54.9</td>
<td>84.7</td>
<td>79.5</td>
<td>69.9</td>
<td>75.5</td>
<td>42.6</td>
<td>59.1</td>
</tr>
<tr>
<td>Ties-Merging</td>
<td>68.3</td>
<td>65.5</td>
<td>76.9</td>
<td>54.9</td>
<td>75.4</td>
<td>72.0</td>
<td>68.9</td>
<td>73.1</td>
<td>47.3</td>
<td>60.2</td>
</tr>
<tr>
<td>Layer-wise AdaMerging</td>
<td>68.4</td>
<td>71.9</td>
<td>87.9</td>
<td>69.1</td>
<td>92.2</td>
<td>93.8</td>
<td>80.5</td>
<td>77.7</td>
<td>47.3</td>
<td>62.5</td>
</tr>
<tr>
<td>Weight-Ensembling MoE</td>
<td>75.4</td>
<td>77.5</td>
<td>94.3</td>
<td>77.0</td>
<td>96.8</td>
<td>98.7</td>
<td>86.6</td>
<td>78.3</td>
<td>44.0</td>
<td>61.1</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<table>
<thead>
<tr>
<th></th>
<th>Seen Tasks</th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th>Unseen Tasks</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Method</td>
<td>SUN397</td>
<td>Cars</td>
<td>GTSRB</td>
<td>EuroSAT</td>
<td>DTD</td>
<td>MNIST</td>
<td>Avg.</td>
<td>RESISC45</td>
<td>SVHN</td>
<td>Avg.</td>
</tr>
<tr>
<td>Pre-trained</td>
<td>63.2</td>
<td>59.9</td>
<td>30.4</td>
<td>45.6</td>
<td>43.9</td>
<td>47.6</td>
<td>48.4</td>
<td>60.6</td>
<td>23.5</td>
<td>40.1</td>
</tr>
<tr>
<td>Fisher Merging</td>
<td>68.1</td>
<td>67.4</td>
<td>67.2</td>
<td>86.4</td>
<td>58.6</td>
<td>81.6</td>
<td>71.5</td>
<td>60.2</td>
<td>42.5</td>
<td>51.3</td>
</tr>
<tr>
<td>RegMean</td>
<td>69.4</td>
<td>70.5</td>
<td>86.9</td>
<td>97.0</td>
<td>67.1</td>
<td>98.3</td>
<td>81.5</td>
<td>50.2</td>
<td>51.5</td>
<td>50.8</td>
</tr>
<tr>
<td>Task Arithmetic</td>
<td>65.2</td>
<td>63.6</td>
<td>76.1</td>
<td>87.1</td>
<td>56.4</td>
<td>94.2</td>
<td>73.8</td>
<td>52.4</td>
<td>45.2</td>
<td>48.8</td>
</tr>
<tr>
<td>Ties-Merging</td>
<td>68.2</td>
<td>65.9</td>
<td>70.0</td>
<td>81.2</td>
<td>56.0</td>
<td>89.0</td>
<td>71.7</td>
<td>60.3</td>
<td>47.3</td>
<td>53.8</td>
</tr>
<tr>
<td>Layer-wise AdaMerging</td>
<td>69.8</td>
<td>72.4</td>
<td>95.5</td>
<td>95.1</td>
<td>70.7</td>
<td>98.1</td>
<td>83.6</td>
<td>48.7</td>
<td>60.7</td>
<td>54.7</td>
</tr>
<tr>
<td>Weight-Ensembling MoE</td>
<td>74.3</td>
<td>78.1</td>
<td>98.8</td>
<td>98.7</td>
<td>75.1</td>
<td>99.5</td>
<td>87.4</td>
<td>47.3</td>
<td>51.3</td>
<td>49.3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Table: Results of the robustness experiments (<span class="arithmatex">\(\lambda=0.3\)</span>).</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Cars</th>
<th>EuroSAT</th>
<th>RESISC45</th>
<th>GTSRB</th>
<th>Avg.</th>
<th>Cars</th>
<th>EuroSAT</th>
<th>RESISC45</th>
<th>GTSRB</th>
<th>Avg.</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>Clean Test set</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Motion Blur</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Fisher Merging</td>
<td>66.0</td>
<td>92.7</td>
<td>83.7</td>
<td>78.7</td>
<td>80.3</td>
<td>60.7</td>
<td>57.6</td>
<td>81.7</td>
<td>78.4</td>
<td>69.6</td>
</tr>
<tr>
<td>RegMean</td>
<td>72.1</td>
<td>97.5</td>
<td>88.9</td>
<td>93.9</td>
<td>88.1</td>
<td>70.0</td>
<td>71.3</td>
<td>87.5</td>
<td>86.8</td>
<td>78.9</td>
</tr>
<tr>
<td>Task Arithmetic</td>
<td>64.6</td>
<td>91.8</td>
<td>80.2</td>
<td>74.8</td>
<td>77.9</td>
<td>62.4</td>
<td>59.2</td>
<td>78.5</td>
<td>63.3</td>
<td>65.9</td>
</tr>
<tr>
<td>Ties-Merging</td>
<td>65.2</td>
<td>83.3</td>
<td>78.1</td>
<td>67.4</td>
<td>73.5</td>
<td>64.4</td>
<td>53.9</td>
<td>76.4</td>
<td>57.1</td>
<td>62.9</td>
</tr>
<tr>
<td>Layer-wise AdaMerging</td>
<td>75.2</td>
<td>94.3</td>
<td>87.6</td>
<td>96.7</td>
<td>88.5</td>
<td>72.4</td>
<td>72.7</td>
<td>85.3</td>
<td>94.3</td>
<td>81.2</td>
</tr>
<tr>
<td>Weight-Ensembling MoE</td>
<td>77.4</td>
<td>98.9</td>
<td>94.4</td>
<td>99.0</td>
<td>92.4</td>
<td>76.5</td>
<td>74.2</td>
<td>93.7</td>
<td>97.4</td>
<td>85.5</td>
</tr>
<tr>
<td></td>
<td>Impulse Noise</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Gaussian Noise</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Fisher Merging</td>
<td>61.5</td>
<td>50.0</td>
<td>74.7</td>
<td>52.6</td>
<td>59.7</td>
<td>61.6</td>
<td>48.1</td>
<td>76.0</td>
<td>51.3</td>
<td>59.3</td>
</tr>
<tr>
<td>RegMean</td>
<td>66.9</td>
<td>51.0</td>
<td>80.6</td>
<td>68.7</td>
<td>66.8</td>
<td>69.4</td>
<td>41.8</td>
<td>84.0</td>
<td>67.7</td>
<td>65.7</td>
</tr>
<tr>
<td>Task Arithmetic</td>
<td>59.8</td>
<td>53.3</td>
<td>72.3</td>
<td>45.0</td>
<td>57.6</td>
<td>61.5</td>
<td>52.5</td>
<td>75.0</td>
<td>50.1</td>
<td>59.8</td>
</tr>
<tr>
<td>Ties-Merging</td>
<td>60.2</td>
<td>45.6</td>
<td>69.8</td>
<td>38.3</td>
<td>53.5</td>
<td>61.8</td>
<td>47.3</td>
<td>73.1</td>
<td>42.3</td>
<td>56.1</td>
</tr>
<tr>
<td>Layer-wise AdaMerging</td>
<td>69.2</td>
<td>40.0</td>
<td>79.6</td>
<td>83.3</td>
<td>68.0</td>
<td>70.0</td>
<td>53.3</td>
<td>82.1</td>
<td>80.0</td>
<td>71.4</td>
</tr>
<tr>
<td>Weight-Ensembling MoE</td>
<td>75.1</td>
<td>9.7</td>
<td>91.5</td>
<td>91.8</td>
<td>67.0</td>
<td>76.5</td>
<td>9.6</td>
<td>92.7</td>
<td>88.7</td>
<td>66.8</td>
</tr>
<tr>
<td></td>
<td>Pixelate</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Spatter</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Fisher Merging</td>
<td>2.2</td>
<td>34.0</td>
<td>17.0</td>
<td>63.2</td>
<td>29.1</td>
<td>61.4</td>
<td>64.2</td>
<td>74.6</td>
<td>47.3</td>
<td>61.9</td>
</tr>
<tr>
<td>RegMean</td>
<td>2.3</td>
<td>38.3</td>
<td>18.2</td>
<td>89.4</td>
<td>37.0</td>
<td>67.7</td>
<td>60.0</td>
<td>81.3</td>
<td>81.9</td>
<td>72.7</td>
</tr>
<tr>
<td>Task Arithmetic</td>
<td>2.3</td>
<td>33.2</td>
<td>19.1</td>
<td>65.6</td>
<td>30.0</td>
<td>61.0</td>
<td>62.5</td>
<td>72.8</td>
<td>57.0</td>
<td>63.3</td>
</tr>
<tr>
<td>Ties-Merging</td>
<td>3.3</td>
<td>31.8</td>
<td>18.0</td>
<td>58.5</td>
<td>27.9</td>
<td>61.3</td>
<td>52.9</td>
<td>70.3</td>
<td>48.1</td>
<td>58.2</td>
</tr>
<tr>
<td>Layer-wise AdaMerging</td>
<td>1.3</td>
<td>52.9</td>
<td>21.0</td>
<td>91.0</td>
<td>41.5</td>
<td>68.4</td>
<td>55.9</td>
<td>78.3</td>
<td>92.3</td>
<td>73.7</td>
</tr>
<tr>
<td>Weight-Ensembling MoE</td>
<td>0.5</td>
<td>11.6</td>
<td>2.3</td>
<td>97.5</td>
<td>28.0</td>
<td>75.1</td>
<td>9.7</td>
<td>91.4</td>
<td>96.3</td>
<td>68.1</td>
</tr>
<tr>
<td></td>
<td>Contrast</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>JPEG Compression</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Fisher Merging</td>
<td>63.8</td>
<td>58.4</td>
<td>75.5</td>
<td>70.4</td>
<td>67.0</td>
<td>66.3</td>
<td>67.6</td>
<td>82.6</td>
<td>58.9</td>
<td>68.8</td>
</tr>
<tr>
<td>RegMean</td>
<td>69.6</td>
<td>64.8</td>
<td>84.4</td>
<td>90.0</td>
<td>77.2</td>
<td>71.5</td>
<td>72.6</td>
<td>88.7</td>
<td>82.2</td>
<td>78.7</td>
</tr>
<tr>
<td>Task Arithmetic</td>
<td>62.3</td>
<td>55.7</td>
<td>75.3</td>
<td>70.8</td>
<td>66.0</td>
<td>63.9</td>
<td>66.1</td>
<td>80.1</td>
<td>61.0</td>
<td>67.8</td>
</tr>
<tr>
<td>Ties-Merging</td>
<td>64.2</td>
<td>52.4</td>
<td>74.8</td>
<td>63.5</td>
<td>63.7</td>
<td>65.0</td>
<td>59.5</td>
<td>77.9</td>
<td>53.2</td>
<td>63.9</td>
</tr>
<tr>
<td>Layer-wise AdaMerging</td>
<td>73.1</td>
<td>67.4</td>
<td>83.0</td>
<td>96.2</td>
<td>79.9</td>
<td>72.9</td>
<td>70.7</td>
<td>86.3</td>
<td>90.6</td>
<td>80.1</td>
</tr>
<tr>
<td>Weight-Ensembling MoE</td>
<td>77.2</td>
<td>34.7</td>
<td>93.1</td>
<td>98.4</td>
<td>75.9</td>
<td>77.3</td>
<td>61.0</td>
<td>94.1</td>
<td>95.7</td>
<td>82.0</td>
</tr>
</tbody>
</table>
<h2 id="references">References<a class="headerlink" href="#references" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<h4 id="fusion_bench.modelpool.clip_vision" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <code>clip_vision</code>


<a href="#fusion_bench.modelpool.clip_vision" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents first">









  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h5 id="fusion_bench.modelpool.clip_vision.modelpool" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <code>modelpool</code>


<a href="#fusion_bench.modelpool.clip_vision.modelpool" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h6 id="fusion_bench.modelpool.clip_vision.modelpool.CLIPVisionModelPool" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>CLIPVisionModelPool</code>


<a href="#fusion_bench.modelpool.clip_vision.modelpool.CLIPVisionModelPool" class="headerlink" title="Permanent link">&para;</a></h6>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="            BaseModelPool (fusion_bench.modelpool.base_pool.BaseModelPool)" href="../#fusion_bench.modelpool.BaseModelPool">BaseModelPool</a></code></p>


        <p>A model pool for managing Hugging Face's CLIP Vision models.</p>
<p>This class extends the base <code>ModelPool</code> class and overrides its methods to handle
the specifics of the CLIP Vision models provided by the Hugging Face Transformers library.</p>







              <details class="quote">
                <summary>Source code in <code>fusion_bench/modelpool/clip_vision/modelpool.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="k">class</span><span class="w"> </span><span class="nc">CLIPVisionModelPool</span><span class="p">(</span><span class="n">BaseModelPool</span><span class="p">):</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">    A model pool for managing Hugging Face&#39;s CLIP Vision models.</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    This class extends the base `ModelPool` class and overrides its methods to handle</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    the specifics of the CLIP Vision models provided by the Hugging Face Transformers library.</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a>    <span class="n">_config_mapping</span> <span class="o">=</span> <span class="n">BaseModelPool</span><span class="o">.</span><span class="n">_config_mapping</span> <span class="o">|</span> <span class="p">{</span><span class="s2">&quot;_processor&quot;</span><span class="p">:</span> <span class="s2">&quot;processor&quot;</span><span class="p">}</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a>        <span class="n">models</span><span class="p">:</span> <span class="n">DictConfig</span><span class="p">,</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a>        <span class="n">processor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DictConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="p">):</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">models</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_processor</span> <span class="o">=</span> <span class="n">processor</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_processor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CLIPProcessor</span><span class="p">:</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_processor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Processor is not defined in the config&quot;</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_processor</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading `transformers.CLIPProcessor`: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_processor</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a>            <span class="n">processor</span> <span class="o">=</span> <span class="n">CLIPProcessor</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_processor</span><span class="p">)</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a>            <span class="n">processor</span> <span class="o">=</span> <span class="n">instantiate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_processor</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a>        <span class="k">return</span> <span class="n">processor</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_clip_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CLIPModel</span><span class="p">:</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a>        <span class="n">model_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_models</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model_config</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading `transformers.CLIPModel`: </span><span class="si">{</span><span class="n">model_config</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a>            <span class="n">clip_model</span> <span class="o">=</span> <span class="n">CLIPModel</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">model_config</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a>            <span class="k">return</span> <span class="n">clip_model</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a>            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a>                <span class="n">model_config</span><span class="p">,</span> <span class="n">DictConfig</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a>            <span class="p">),</span> <span class="s2">&quot;Model config must be a DictConfig&quot;</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a>            <span class="n">model_config</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">model_config</span><span class="p">)</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a>            <span class="k">with</span> <span class="n">open_dict</span><span class="p">(</span><span class="n">model_config</span><span class="p">):</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>                <span class="n">model_config</span><span class="o">.</span><span class="n">_target_</span> <span class="o">=</span> <span class="s2">&quot;transformers.CLIPModel.from_pretrained&quot;</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a>            <span class="n">clip_model</span> <span class="o">=</span> <span class="n">instantiate</span><span class="p">(</span><span class="n">model_config</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a>            <span class="k">return</span> <span class="n">clip_model</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="nd">@override</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">CLIPVisionModel</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">        Save a CLIP Vision model to the given path.</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">        Args:</span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">            model (CLIPVisionModel): The model to save.</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">            path (str): The path to save the model to.</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a>        <span class="k">with</span> <span class="n">timeit_context</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Saving clip vision model to &quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">):</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>            <span class="n">model</span><span class="o">.</span><span class="n">save_pretrained</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_model</span><span class="p">(</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">model_name_or_config</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DictConfig</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CLIPVisionModel</span><span class="p">:</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        This method is used to load a CLIPVisionModel from the model pool.</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        Example configuration could be:</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">        ```yaml</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">        models:</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">            cifar10: tanganke/clip-vit-base-patch32_cifar10</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">            sun397: tanganke/clip-vit-base-patch32_sun397</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">            stanford-cars: tanganke/clip-vit-base-patch32_stanford-cars</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">        ```</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">        Args:</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">            model_name_or_config (Union[str, DictConfig]): The name of the model or the model configuration.</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">        Returns:</span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">            CLIPVisionModel: The loaded CLIPVisionModel.</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a>            <span class="nb">isinstance</span><span class="p">(</span><span class="n">model_name_or_config</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a>            <span class="ow">and</span> <span class="n">model_name_or_config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_models</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="p">):</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a>            <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_models</span><span class="p">[</span><span class="n">model_name_or_config</span><span class="p">]</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading `transformers.CLIPVisionModel`: </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a>                <span class="k">return</span> <span class="n">CLIPVisionModel</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a>                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Returning existing model: </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a>                <span class="k">return</span> <span class="n">model</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="c1"># If the model is not a string, we use the default load_model method</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">model_name_or_config</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_train_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="n">dataset_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_train_datasets</span><span class="p">[</span><span class="n">dataset_name</span><span class="p">]</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset_config</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a>                <span class="sa">f</span><span class="s2">&quot;Loading train dataset using `datasets.load_dataset`: </span><span class="si">{</span><span class="n">dataset_config</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a>            <span class="p">)</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a>            <span class="n">dataset</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="n">dataset_config</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">)</span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a>            <span class="n">dataset</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">load_train_dataset</span><span class="p">(</span><span class="n">dataset_name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="k">return</span> <span class="n">dataset</span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_val_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="n">dataset_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_val_datasets</span><span class="p">[</span><span class="n">dataset_name</span><span class="p">]</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset_config</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a>                <span class="sa">f</span><span class="s2">&quot;Loading validation dataset using `datasets.load_dataset`: </span><span class="si">{</span><span class="n">dataset_config</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a>            <span class="p">)</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a>            <span class="n">dataset</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="n">dataset_config</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">&quot;validation&quot;</span><span class="p">)</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a>            <span class="n">dataset</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">load_val_dataset</span><span class="p">(</span><span class="n">dataset_name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="k">return</span> <span class="n">dataset</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_test_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="n">dataset_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_datasets</span><span class="p">[</span><span class="n">dataset_name</span><span class="p">]</span>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset_config</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a>                <span class="sa">f</span><span class="s2">&quot;Loading test dataset using `datasets.load_dataset`: </span><span class="si">{</span><span class="n">dataset_config</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a>            <span class="p">)</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a>            <span class="n">dataset</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="n">dataset_config</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a>            <span class="n">dataset</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">load_test_dataset</span><span class="p">(</span><span class="n">dataset_name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a>        <span class="k">return</span> <span class="n">dataset</span>
</span></code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h7 id="fusion_bench.modelpool.clip_vision.modelpool.CLIPVisionModelPool.load_model" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">load_model</span><span class="p">(</span><span class="n">model_name_or_config</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#fusion_bench.modelpool.clip_vision.modelpool.CLIPVisionModelPool.load_model" class="headerlink" title="Permanent link">&para;</a></h7>


    <div class="doc doc-contents ">

        <p>This method is used to load a CLIPVisionModel from the model pool.</p>
<p>Example configuration could be:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nt">models</span><span class="p">:</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">    </span><span class="nt">cifar10</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tanganke/clip-vit-base-patch32_cifar10</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">    </span><span class="nt">sun397</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tanganke/clip-vit-base-patch32_sun397</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">    </span><span class="nt">stanford-cars</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tanganke/clip-vit-base-patch32_stanford-cars</span>
</span></code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h8 id="fusion_bench.modelpool.clip_vision.modelpool.CLIPVisionModelPool.load_model(model_name_or_config)" class="doc doc-heading doc-heading-parameter">              <b><code>model_name_or_config</code></b>
<a href="#fusion_bench.modelpool.clip_vision.modelpool.CLIPVisionModelPool.load_model(model_name_or_config)" class="headerlink" title="Permanent link">&para;</a></h8>              (<code><span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="omegaconf.DictConfig">DictConfig</span>]</code>)
          –
          <div class="doc-md-description">
            <p>The name of the model or the model configuration.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>CLIPVisionModel</code></b> (              <code><span title="transformers.CLIPVisionModel">CLIPVisionModel</span></code>
)          –
          <div class="doc-md-description">
            <p>The loaded CLIPVisionModel.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>fusion_bench/modelpool/clip_vision/modelpool.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_model</span><span class="p">(</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">model_name_or_config</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DictConfig</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CLIPVisionModel</span><span class="p">:</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    This method is used to load a CLIPVisionModel from the model pool.</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">    Example configuration could be:</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">    ```yaml</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">    models:</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">        cifar10: tanganke/clip-vit-base-patch32_cifar10</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">        sun397: tanganke/clip-vit-base-patch32_sun397</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">        stanford-cars: tanganke/clip-vit-base-patch32_stanford-cars</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">    ```</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">    Args:</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">        model_name_or_config (Union[str, DictConfig]): The name of the model or the model configuration.</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">        CLIPVisionModel: The loaded CLIPVisionModel.</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="k">if</span> <span class="p">(</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="nb">isinstance</span><span class="p">(</span><span class="n">model_name_or_config</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="ow">and</span> <span class="n">model_name_or_config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_models</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="p">):</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_models</span><span class="p">[</span><span class="n">model_name_or_config</span><span class="p">]</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading `transformers.CLIPVisionModel`: </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a>            <span class="k">return</span> <span class="n">CLIPVisionModel</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Returning existing model: </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="k">return</span> <span class="n">model</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span class="c1"># If the model is not a string, we use the default load_model method</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">model_name_or_config</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="fusion_bench.modelpool.clip_vision.modelpool.CLIPVisionModelPool.save_model" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">save_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></code>

<a href="#fusion_bench.modelpool.clip_vision.modelpool.CLIPVisionModelPool.save_model" class="headerlink" title="Permanent link">&para;</a></h7>


    <div class="doc doc-contents ">

        <p>Save a CLIP Vision model to the given path.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h8 id="fusion_bench.modelpool.clip_vision.modelpool.CLIPVisionModelPool.save_model(model)" class="doc doc-heading doc-heading-parameter">              <b><code>model</code></b>
<a href="#fusion_bench.modelpool.clip_vision.modelpool.CLIPVisionModelPool.save_model(model)" class="headerlink" title="Permanent link">&para;</a></h8>              (<code><span title="transformers.CLIPVisionModel">CLIPVisionModel</span></code>)
          –
          <div class="doc-md-description">
            <p>The model to save.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h8 id="fusion_bench.modelpool.clip_vision.modelpool.CLIPVisionModelPool.save_model(path)" class="doc doc-heading doc-heading-parameter">              <b><code>path</code></b>
<a href="#fusion_bench.modelpool.clip_vision.modelpool.CLIPVisionModelPool.save_model(path)" class="headerlink" title="Permanent link">&para;</a></h8>              (<code><span title="str">str</span></code>)
          –
          <div class="doc-md-description">
            <p>The path to save the model to.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>fusion_bench/modelpool/clip_vision/modelpool.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="nd">@override</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">CLIPVisionModel</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">    Save a CLIP Vision model to the given path.</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">    Args:</span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">        model (CLIPVisionModel): The model to save.</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        path (str): The path to save the model to.</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a>    <span class="k">with</span> <span class="n">timeit_context</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Saving clip vision model to &quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">):</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>        <span class="n">model</span><span class="o">.</span><span class="n">save_pretrained</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="fusion_bench.models.linearized.vision_model" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <code>vision_model</code>


<a href="#fusion_bench.models.linearized.vision_model" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="fusion_bench.models.linearized.vision_model.linearize_lora_model_" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">linearize_lora_model_</span><span class="p">(</span><span class="n">model</span><span class="p">)</span></code>

<a href="#fusion_bench.models.linearized.vision_model.linearize_lora_model_" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Linearizes the LoraLayer modules in a PyTorch model according to the PETA paper.</p>


            <details class="quote">
              <summary>Source code in <code>fusion_bench/models/linearized/vision_model.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="k">def</span><span class="w"> </span><span class="nf">linearize_lora_model_</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    Linearizes the LoraLayer modules in a PyTorch model according to the PETA paper.</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">module</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">named_modules</span><span class="p">():</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a>        <span class="c1"># if isinstance(module, LoraLayer) and isinstance(module, nn.Linear):</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">LoraLayer</span><span class="p">):</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a>            <span class="c1"># print(&quot;L-LoRA MODULE : &quot;, module)</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a>            <span class="n">parent</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">target_name</span> <span class="o">=</span> <span class="n">_get_submodules</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a>            <span class="nb">setattr</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">target_name</span><span class="p">,</span> <span class="n">LinearizedModelWraper</span><span class="p">(</span><span class="n">target</span><span class="p">))</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a>            <span class="c1"># print(&quot;Linearized Lora Layer&quot;)</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="k">return</span> <span class="n">model</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="fusion_bench.models.linearized.vision_model.load_fft_vision_model_hf" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">load_fft_vision_model_hf</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">return_vison_model</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#fusion_bench.models.linearized.vision_model.load_fft_vision_model_hf" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Load a CLIP vision model from Hugging Face.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h6 id="fusion_bench.models.linearized.vision_model.load_fft_vision_model_hf(model_name)" class="doc doc-heading doc-heading-parameter">              <b><code>model_name</code></b>
<a href="#fusion_bench.models.linearized.vision_model.load_fft_vision_model_hf(model_name)" class="headerlink" title="Permanent link">&para;</a></h6>              (<code><span title="str">str</span></code>)
          –
          <div class="doc-md-description">
            <p>The name of the CLIP vision model to load from Hugging Face.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h6 id="fusion_bench.models.linearized.vision_model.load_fft_vision_model_hf(return_vison_model)" class="doc doc-heading doc-heading-parameter">              <b><code>return_vison_model</code></b>
<a href="#fusion_bench.models.linearized.vision_model.load_fft_vision_model_hf(return_vison_model)" class="headerlink" title="Permanent link">&para;</a></h6>              (<code><span title="bool">bool</span></code>, default:
                  <code>True</code>
)
          –
          <div class="doc-md-description">
            <p>If False, the full CLIPVisionModel is returned. If True, only the vision model (<code>CLIPVisionTransformer</code>) is returned. Defaults to True.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="typing.Union">Union</span>[<span title="transformers.models.clip.modeling_clip.CLIPVisionTransformer">CLIPVisionTransformer</span>, <span title="transformers.CLIPVisionModel">CLIPVisionModel</span>]</code>
          –
          <div class="doc-md-description">
            <p>Union[CLIPVisionTransformer, CLIPVisionModel]: The vision model.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>fusion_bench/models/linearized/vision_model.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_fft_vision_model_hf</span><span class="p">(</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">return_vison_model</span><span class="o">=</span><span class="kc">True</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">CLIPVisionTransformer</span><span class="p">,</span> <span class="n">CLIPVisionModel</span><span class="p">]:</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">    Load a CLIP vision model from Hugging Face.</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">    Args:</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        model_name (str): The name of the CLIP vision model to load from Hugging Face.</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        return_vison_model (bool, optional): If False, the full CLIPVisionModel is returned. If True, only the vision model (`CLIPVisionTransformer`) is returned. Defaults to True.</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">        Union[CLIPVisionTransformer, CLIPVisionModel]: The vision model.</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">CLIPVisionModel</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="k">if</span> <span class="n">return_vison_model</span><span class="p">:</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="k">return</span> <span class="n">CLIPVisionModel</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span><span class="o">.</span><span class="n">vision_model</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="k">return</span> <span class="n">model</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="fusion_bench.models.linearized.vision_model.load_l_lora_vision_model_hf" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">load_l_lora_vision_model_hf</span><span class="p">(</span><span class="n">base_model_name</span><span class="p">,</span> <span class="n">peft_name</span><span class="p">)</span></code>

<a href="#fusion_bench.models.linearized.vision_model.load_l_lora_vision_model_hf" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Load a linearized L-LoRA model from a base model and a Peft model (HuggingFace).</p>


            <details class="quote">
              <summary>Source code in <code>fusion_bench/models/linearized/vision_model.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_l_lora_vision_model_hf</span><span class="p">(</span><span class="n">base_model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">peft_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">    Load a linearized L-LoRA model from a base model and a Peft model (HuggingFace).</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span class="n">base_model</span> <span class="o">=</span> <span class="n">CLIPVisionModel</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">base_model_name</span><span class="p">)</span><span class="o">.</span><span class="n">vision_model</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="n">peft_config</span> <span class="o">=</span> <span class="n">LoraConfig</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">peft_name</span><span class="p">)</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="n">peft_config</span><span class="o">.</span><span class="n">inference_mode</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># This is important, make the model trainable</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">get_peft_model</span><span class="p">(</span><span class="n">base_model</span><span class="p">,</span> <span class="n">peft_config</span><span class="p">)</span>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="n">linearize_lora_model_</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;linearized_adapter_model.safetensors&quot;</span><span class="p">]:</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="n">path</span> <span class="o">=</span> <span class="n">get_file_path</span><span class="p">(</span><span class="n">peft_name</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="n">state_dict</span> <span class="o">=</span> <span class="n">load_file</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">state_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a>            <span class="n">model</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">param</span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="k">return</span> <span class="n">model</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="fusion_bench.models.linearized.vision_model.load_lora_vision_model_hf" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">load_lora_vision_model_hf</span><span class="p">(</span><span class="n">base_model_name</span><span class="p">,</span> <span class="n">peft_name</span><span class="p">,</span> <span class="n">merge_and_unload</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">return_vison_model</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#fusion_bench.models.linearized.vision_model.load_lora_vision_model_hf" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Load a LoRA (Low-Rank Adaptation) vision model from Hugging Face.</p>
<p>This function loads a vision model and applies a LoRA adaptation to it. The model can be optionally merged and unloaded.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h6 id="fusion_bench.models.linearized.vision_model.load_lora_vision_model_hf(base_model_name)" class="doc doc-heading doc-heading-parameter">              <b><code>base_model_name</code></b>
<a href="#fusion_bench.models.linearized.vision_model.load_lora_vision_model_hf(base_model_name)" class="headerlink" title="Permanent link">&para;</a></h6>              (<code><span title="str">str</span></code>)
          –
          <div class="doc-md-description">
            <p>The name of the base vision model to load from Hugging Face.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h6 id="fusion_bench.models.linearized.vision_model.load_lora_vision_model_hf(peft_name)" class="doc doc-heading doc-heading-parameter">              <b><code>peft_name</code></b>
<a href="#fusion_bench.models.linearized.vision_model.load_lora_vision_model_hf(peft_name)" class="headerlink" title="Permanent link">&para;</a></h6>              (<code><span title="str">str</span></code>)
          –
          <div class="doc-md-description">
            <p>The name of the LoRA adaptation to apply to the base model.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h6 id="fusion_bench.models.linearized.vision_model.load_lora_vision_model_hf(merge_and_unload)" class="doc doc-heading doc-heading-parameter">              <b><code>merge_and_unload</code></b>
<a href="#fusion_bench.models.linearized.vision_model.load_lora_vision_model_hf(merge_and_unload)" class="headerlink" title="Permanent link">&para;</a></h6>              (<code><span title="bool">bool</span></code>, default:
                  <code>False</code>
)
          –
          <div class="doc-md-description">
            <p>If True, the LoRA adaptation is merged into the base model and the LoRA layers are removed. Defaults to False.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h6 id="fusion_bench.models.linearized.vision_model.load_lora_vision_model_hf(return_vison_model)" class="doc doc-heading doc-heading-parameter">              <b><code>return_vison_model</code></b>
<a href="#fusion_bench.models.linearized.vision_model.load_lora_vision_model_hf(return_vison_model)" class="headerlink" title="Permanent link">&para;</a></h6>              (<code><span title="bool">bool</span></code>, default:
                  <code>True</code>
)
          –
          <div class="doc-md-description">
            <p>If False, the full CLIPVisionModel is returned. If True, only the vision model (<code>CLIPVisionTransformer</code>) is returned. Defaults to True.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>PeftModel</code></b>          –
          <div class="doc-md-description">
            <p>The adapted vision model, optionally merged and unloaded.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>fusion_bench/models/linearized/vision_model.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_lora_vision_model_hf</span><span class="p">(</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="n">base_model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="n">peft_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="n">merge_and_unload</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="n">return_vison_model</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="p">):</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">    Load a LoRA (Low-Rank Adaptation) vision model from Hugging Face.</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    This function loads a vision model and applies a LoRA adaptation to it. The model can be optionally merged and unloaded.</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    Parameters:</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">        base_model_name (str): The name of the base vision model to load from Hugging Face.</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        peft_name (str): The name of the LoRA adaptation to apply to the base model.</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        merge_and_unload (bool, optional): If True, the LoRA adaptation is merged into the base model and the LoRA layers are removed. Defaults to False.</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        return_vison_model (bool, optional): If False, the full CLIPVisionModel is returned. If True, only the vision model (`CLIPVisionTransformer`) is returned. Defaults to True.</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">        PeftModel: The adapted vision model, optionally merged and unloaded.</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">CLIPVisionModel</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">base_model_name</span><span class="p">)</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="c1"># Load the Peft model</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a>    <span class="c1"># note that we apply lora on type `CLIPVisionTransformer` instead of `CLIPVisionModel`</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="n">vision_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">vision_model</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="n">peft_model</span> <span class="o">=</span> <span class="n">PeftModel</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">vision_model</span><span class="p">,</span> <span class="n">peft_name</span><span class="p">,</span> <span class="n">is_trainable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="k">if</span> <span class="n">merge_and_unload</span><span class="p">:</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="n">vision_model</span> <span class="o">=</span> <span class="n">peft_model</span><span class="o">.</span><span class="n">merge_and_unload</span><span class="p">()</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="n">vision_model</span> <span class="o">=</span> <span class="n">peft_model</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="c1"># Return the vision model</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="k">if</span> <span class="n">return_vison_model</span><span class="p">:</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="k">return</span> <span class="n">vision_model</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="n">model</span><span class="o">.</span><span class="n">vision_model</span> <span class="o">=</span> <span class="n">vision_model</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="k">return</span> <span class="n">model</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>Dan Hendrycks and Thomas Dietterich. Benchmarking neural network robustness to common corruptions and perturbations. Proceedings of the International Conference on Learning Representations, 2019.&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../" class="md-footer__link md-footer__link--prev" aria-label="Previous: Introduction to Model Pool Module">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Introduction to Model Pool Module
              </div>
            </div>
          </a>
        
        
          
          <a href="../nyuv2/" class="md-footer__link md-footer__link--next" aria-label="Next: ResNet Models for Sence Understanding">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                ResNet Models for Sence Understanding
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/tanganke/fusion_bench" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["toc.follow", "content.code.annotate", "content.code.copy", "navigation.top", "navigation.tabs", "navigation.footer", "navigation.expand", "search.suggest", "search.highlight"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>